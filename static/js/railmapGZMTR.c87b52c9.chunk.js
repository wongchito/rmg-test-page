(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[66],{146:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}n.d(t,"a",(function(){return r}))},147:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},149:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return a}))},153:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return m})),n.d(t,"a",(function(){return f})),n.d(t,"d",(function(){return h}));var r=n(147),a=n(149),c=n(53),i=n(9),s=n(3),l=(n(43),function(e,t,n){return Object.keys(e).reduce((function(r,a){return Object(s.a)({},r,Object(i.a)({},a,e[a].children.reduce((function(r,c){return Object(s.a)({},r,Object(i.a)({},c,1+t(e,c)+n(e,a)))}),{})))}),{})}),o=function e(t,n,r){if(t==n)return{len:0,nodes:[t]};var a=[],c=[];Object.keys(r[t]).forEach((function(i){var s=e(i,n,r);s.len<0||(a.push(r[t][i]+s.len),s.nodes.unshift(t),c.push(s.nodes))}));var i=Math.max.apply(Math,a);return{len:i,nodes:c[a.indexOf(i)]}},u=function(e,t,n){var r=o("linestart","lineend",t);if(r.nodes.includes(e))return o(r.nodes[1],e,t).len;for(var a=n.filter((function(t){return t.includes(e)}))[0],c=e;!r.nodes.includes(c);)c=a[a.indexOf(c)-1];for(var i=e;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var s="linestart"===c,l=[];return s||"lineend"===i?s?(l[0]=0,l[1]=o(r.nodes[1],i,t).len,l[2]=o(a[1],e,t).len,l[3]=o(e,i,t).len):(l[0]=o(r.nodes[1],c,t).len,l[1]=o(c,r.nodes.slice(-2)[0],t).len,l[2]=o(c,e,t).len,l[3]=o(e,a.slice(-2)[0],t).len):(l[0]=o(r.nodes[1],c,t).len,l[1]=o(c,i,t).len,l[2]=o(c,e,t).len,l[3]=o(e,i,t).len),l[0]+l[2]*l[1]/(l[2]+l[3])},m=function(e,t,n){var r;return console.log("computing stations' states"),Object(c.a)(new Set((r=[]).concat.apply(r,Object(c.a)(t)))).reduce((function(r,a){return Object(s.a)({},r,Object(i.a)({},a,a===e?0:("r"===n?function(e,t,n){var r=!0,a=!1,c=void 0;try{for(var i,s=n[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value,o=l.indexOf(e),u=l.indexOf(t);if(-1!==o&&o<u)return!0}}catch(m){a=!0,c=m}finally{try{r||null==s.return||s.return()}finally{if(a)throw c}}return!1}(e,a,t):function(e,t,n){var r=!0,a=!1,c=void 0;try{for(var i,s=n[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value,o=l.indexOf(e),u=l.indexOf(t);if(-1!==u&&u<o)return!0}}catch(m){a=!0,c=m}finally{try{r||null==s.return||s.return()}finally{if(a)throw c}}return!1}(e,a,t))?1:-1))}),{})},f=function(){function e(t){var n=this;Object(r.a)(this,e),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(e){return 0},this.rightWideFactor=function(e){return 0},this.pathWeight=function(e,t){return n.stnList[e].children.includes(t)?1+n.rightWideFactor(e)+n.leftWideFactor(t):-1/0},this.pathTurnParams=function(e){var t=35-17.5*Math.sqrt(3),n=e-2*t;return{tr:35,dx_a:17.5,dy_a:t,dx_l:n*Math.sqrt(3),dy_l:n}},this.pathTurnSE=function(e){var t=n.pathTurnParams(e),r=t.tr,a=t.dx_a,c=t.dy_a,i=t.dx_l,s=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(c," l ").concat(i,",").concat(s," a ").concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(c)},this.pathTurnNE=function(e){var t=n.pathTurnParams(e),r=t.tr,a=t.dx_a,c=t.dy_a,i=t.dx_l,s=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(-c," l ").concat(i,",").concat(-s," a ").concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(-c)},this.stnList=t.stnList,this.criticalPath=t.criticalPath}return Object(a.a)(e,[{key:"getYShare",value:function(e,t){if(e in this.yShares)return this.yShares[e];if(["linestart","lineend"].includes(e)||this.stnList[e].parents.length>1||this.stnList[e].children.length>1)return this.yShares[e]=0,0;var n=this.stnList[e].parents[0];if(n){if(1==this.stnList[n].children.length){var r=this.getYShare(n);return this.yShares[e]=r,r}var a=0==this.stnList[n].children.indexOf(e)?1:-1;return this.yShares[e]=a,a}return this.yShares[e]=0,0}},{key:"getNamePos",value:function(e){if("linestart"===e)return this.namePoss.linestart=!0,!0;var t=this.criticalPath.nodes.indexOf(e)%2;if(-1===t){var n=this.stnList[e].parents[0];if(2===this.stnList[n].children.length){var r=this.getNamePos(n);return this.namePoss[e]=r,r}var a=!this.getNamePos(n);return this.namePoss[e]=a,a}return this.namePoss[e]=1===t,1===t}},{key:"_linePath",value:function(e,t,n,r,a,c,i){var s=this,l=[],o=l[0],u=l[1],m=l[2],f=[],h=this.pathTurnParams(c),d=h.dx_a+h.dx_l/2,g=(t[1]-t[0])/i.len*.8,p=((t[1]-t[0])/i.len-2*d)/2;return p+g<0&&console.warn("SVG width too small! ".concat(p+g)),e.forEach((function(t){var i=r[t],l=a[t];if(!u&&0!==u)return o=t,m=i,u=l,void(1===e.length?f.push("M ".concat(i,",").concat(l)):n[0].includes(t)?n[0].includes(e[1])?f.push("M ".concat(i,",").concat(l)):(r[e[1]]>0&&f.push("M ".concat(i,",").concat(l+9.68)),a[e[1]]<0&&f.push("M ".concat(i,",").concat(l-9.68))):f.push("M ".concat(i,",").concat(l)));l>u?(f.push("h ".concat(0===l?i-m-g*s.leftWideFactor(t)-p-2*d:g*s.rightWideFactor(o)+p)),f.push(s.pathTurnSE(c))):l<u&&(f.push("h ".concat(0===l?i-m-g*s.leftWideFactor(t)-p-2*d:g*s.rightWideFactor(o)+p)),f.push(s.pathTurnNE(c))),f.push("H ".concat(i)),o=t,m=i,u=l})),f.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(e,t){console.log("computing y shares");var n=new this({stnList:e});return Object.keys(e).forEach((function(e){["linestart","lineend"].includes(e)||e in n.yShares||n.getYShare(e,t)})),n.yShares}},{key:"getNamePos",value:function(e,t){console.log("computing name position");var n=new this({stnList:e,criticalPath:t});return Object.keys(e).forEach((function(e){["linestart","lineend"].includes(e)||e in n.namePoss||n.getNamePos(e)})),n.namePoss}},{key:"drawLine",value:function(e,t,n,r,a,c,i,s){var l=this,o={main:[],pass:[]};return e.map((function(u,m){var f=(u=u.filter((function(e){return!["linestart","lineend"].includes(e)}))).filter((function(e){return t[e]>=0})),h=u.filter((function(e){return t[e]<=0}));1===f.length&&(h=u),0==f.filter((function(e){return-1!==h.indexOf(e)})).length&&f.length&&(h[0]===u[0]?h.push(f[0]):f[0]===u[0]&&f[f.length-1]===u[u.length-1]&&h.length?(h=u,f=[]):h.unshift(f[f.length-1])),o.main.push(new l({stnList:n,criticalPath:s})._linePath(f,r,e,a,c,i,s)),o.pass.push(new l({stnList:n,criticalPath:s})._linePath(h,r,e,a,c,i,s))})),o}}]),e}(),h=function(e,t){var n={main:[],pass:[]};return e.map((function(e){var r=(e=e.filter((function(e){return!["linestart","lineend"].includes(e)}))).filter((function(e){return t[e]>=0})),a=e.filter((function(e){return t[e]<=0}));1===r.length&&(a=e),0==r.filter((function(e){return-1!==a.indexOf(e)})).length&&r.length&&(a[0]===e[0]?a.push(r[0]):r[0]===e[0]&&r[r.length-1]===e[e.length-1]&&a.length?(a=e,r=[]):a.unshift(r[r.length-1])),n.main.push(r),n.pass.push(a)})),n}},185:function(e,t,n){"use strict";var r=n(9),a=n(0);t.a=function(e){var t=function(e){switch(e){case"gz28":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz1421":return 20;default:return 0}}(e.variant),n=a.useMemo((function(){switch(e.variant){case"gz1":return a.createElement("circle",{cy:-28,r:16,fill:"red"});case"gz28":return a.createElement("ellipse",{rx:24,ry:12,fill:"orange"});case"gz3":return a.createElement("rect",{x:-15,y:-25,height:30,width:30,fill:"red"});case"gzgf":return a.createElement("ellipse",{rx:24,ry:12,fill:"white"});case"gz1421":return a.createElement("ellipse",{cy:-8,rx:24,ry:12,fill:"orange"});default:return a.createElement(a.Fragment,null)}}),[e.variant]);return a.createElement("g",null,a.createElement("rect",{id:"strip_gz",style:Object(r.a)({},"--height","".concat(t,"px"))}),a.createElement("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),calc(var(--rmg-svg-height) - 30px))"}},e.isShowLight&&n),e.isShowPSD&&a.createElement(c,e))};var c=a.memo((function(e){return a.createElement("g",{id:"big_psd",fill:["gz3","gz1421","gz1"].includes(e.variant)?"var(--rmg-theme-fg)":"#000",style:Object(r.a)({},"--psd-dy",["gz1","gz3"].includes(e.variant)?"82px":"gz1421"===e.variant?"62px":"58px")},a.createElement("rect",{height:40,width:40,rx:4,x:-20,fill:["gz3","gz1421","gz1"].includes(e.variant)?"var(--rmg-theme-colour)":"#fff"}),a.createElement("text",{className:"rmg-name__en",fontSize:20,dy:12},e.isShowPSD),a.createElement("text",{className:"rmg-name__zh",fontSize:12,dy:26},"\u5c4f\u853d\u95e8"),a.createElement("text",{className:"rmg-name__en",fontSize:6.5,dy:36},"Screen Door"))}),(function(e,t){return e.variant===t.variant&&e.isShowPSD===t.isShowPSD}))},186:function(e,t,n){"use strict";var r=n(13),a=n(146),c=n(0);t.a=function(e){var t=e.lineNum,n=e.stnNum,i=Object(a.a)(e,["lineNum","stnNum"]),s=c.useRef(),l=c.useState({width:15.03125}),o=Object(r.a)(l,2),u=o[0],m=o[1];c.useEffect((function(){return m(s.current.getBBox())}),[t]);var f=u.width>15.03125?15.03125/u.width:1,h=2===t.length?f:1;return c.createElement("g",Object.assign({textAnchor:"middle",fontSize:13.5},i),c.useMemo((function(){return c.createElement(c.Fragment,null,c.createElement("g",{transform:"translate(-9.25,0)scale(".concat(f,")")},c.createElement("text",{ref:s,className:"rmg-name__zh"},t)),c.createElement("g",{transform:"translate(9.25,0)scale(".concat(h,")")},c.createElement("text",{className:"rmg-name__zh"},n)))}),[u.width,t,n]))}},267:function(e,t,n){"use strict";n.r(t);var r=n(13),a=n(146),c=n(9),i=n(53),s=n(0),l=n(23),o=n(185),u=n(3),m=n(186),f=s.memo((function(e){return s.createElement("g",{textAnchor:"middle",fill:-1===e.stnState?"#fff":e.info[3]},s.createElement("use",{xlinkHref:"#intbox",fill:-1===e.stnState?"#aaa":e.info[2]}),e.info[4][0]===e.info[5][0]?s.createElement(d,{name:e.info.slice(-2)}):s.createElement(h,{name:e.info.slice(-2)}))}),(function(e,t){return e.info.toString()===t.info.toString()&&e.stnState===t.stnState})),h=s.memo((function(e){var t,n=[],a=0;null===(t=e.name[0].match(/\d+|\D+/g))||void 0===t||t.forEach((function(e,t){isNaN(Number(e))?(n.push(s.createElement("tspan",{key:t,dominantBaseline:"hanging",dy:1-a},e)),a+=1-a):(n.push(s.createElement("tspan",{key:t,dominantBaseline:"hanging",fontSize:16,dy:-a},e)),a=0)}));var c=s.useRef(),i=s.useState({width:0}),l=Object(r.a)(i,2),o=l[0],u=l[1];s.useEffect((function(){return u(c.current.getBBox())}),[e.name[0]]);var m=o.width>43.5?43.5/o.width:1,f=s.useRef(),h=s.useState({width:0}),d=Object(r.a)(h,2),g=d[0],p=d[1];s.useEffect((function(){return p(f.current.getBBox())}),[e.name[1]]);var E=g.width>43.5?43.5/g.width:1;return s.createElement(s.Fragment,null,s.createElement("text",{ref:c,y:2,className:"rmg-name__zh",fontSize:12,transform:"scale(".concat(m,",1)")},n),s.createElement("text",{ref:f,y:19.5,fontSize:e.name[1].replace("\\"," ").length>10?7:8,className:"rmg-name__en",transform:"scale(".concat(E,",1)")},e.name[1]))}),(function(e,t){return e.name.toString()===t.name.toString()})),d=s.memo((function(e){var t="";for(var n in Object(i.a)(e.name[0])){if(e.name[0][n]!==e.name[1][n])break;t+=e.name[0][n]}var a=s.useRef(),c=s.useState({x:0,width:0}),l=Object(r.a)(c,2),o=l[0],u=l[1];s.useEffect((function(){return u(a.current.getBBox())}),[e.name.toString()]);var m=o.width>43.5?43.5/o.width:1;return s.createElement("g",{transform:"scale(".concat(m,",1)")},s.createElement("g",{transform:"translate(".concat(-o.x-o.width/2,",0)")},s.createElement("text",{ref:a,className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end"},t,s.createElement("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start"},e.name[0].slice(t.length)),s.createElement("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start"},e.name[1].slice(t.length).trim()))))}),(function(e,t){return e.name.toString()===t.name.toString()})),g=function(e){var t=s.useContext(l.b).param,n=t.stn_list[e.stnId],r=2===n.parents.length||2===n.children.length,a=e.stnY>0||1===n.parents.indexOf(n.branch.left[1])||1===n.children.indexOf(n.branch.right[1])?180:0,c=n.name[1].split("\\").length,i=r?180===a?16+12*(c-1)*Math.cos(-45):-9:180===a?-6:(25+15*(c-1))*Math.cos(-45);return s.createElement(s.Fragment,null,s.createElement(x,{intInfos:r?[[t.theme[0],t.theme[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)",t.line_name[0],t.line_name[1]]].concat(n.transfer.info[0]):n.transfer.info[0],stnState:e.stnState,tickRotation:a}),s.createElement("g",null,s.createElement("use",{xlinkHref:"#stn",stroke:-1===e.stnState?"#aaa":"var(--rmg-theme-colour)"}),s.createElement(m.a,{className:"Name ".concat(-1===e.stnState?"Pass":"Future"),lineNum:t.line_num,stnNum:n.num})),s.createElement("g",{style:{transform:"translateX(".concat(-i,"px)")}},s.createElement(p,{name:n.name,stnState:e.stnState,tickRotation:a,isExpress:n.services.includes("express")})))},p=function(e){var t=180===e.tickRotation?17.5:-20-14*e.name[1].split("\\").length*Math.cos(-45),n=s.useRef(),a=s.useState({width:0}),c=Object(r.a)(a,2),i=c[0],l=c[1];return s.useEffect((function(){return l(n.current.getBBox())}),[e.name.toString()]),s.createElement("g",{textAnchor:180===e.tickRotation?"end":"start",className:"Name ".concat(-1===e.stnState?"Pass":0===e.stnState?"CurrentGZ":"Future"),transform:"translate(0,".concat(t,")rotate(-45)")},s.createElement(E,{ref:n,name:e.name}),e.isExpress&&s.createElement(b,{fill:-1===e.stnState?"#aaa":"var(--rmg-theme-colour)",transform:"translate(".concat((i.width+35)*(180===e.tickRotation?-1:1),",").concat(2+5*(e.name[1].split("\\").length-1),")")}))},E=s.forwardRef((function(e,t){return s.useMemo((function(){return s.createElement("g",{ref:t},s.createElement("text",{className:"rmg-name__zh",fontSize:18},e.name[0]),s.createElement("g",{fontSize:10.5},e.name[1].split("\\").map((function(e,t){return s.createElement("text",{key:t,className:"rmg-name__en",dy:16+11*t},e)}))))}),[e.name[0],e.name[1]])})),b=s.memo((function(e){return s.createElement("g",Object.assign({textAnchor:"middle"},e),s.createElement("text",{className:"rmg-name__zh",fontSize:13},"\u5feb\u8f66\u505c\u9760\u7ad9"),s.createElement("text",{dy:10,className:"rmg-name__en",fontSize:6.5},"Express Station"))})),x=function(e){return s.createElement(s.Fragment,null,s.createElement(v,Object.assign({strokeWidth:4},e)),s.createElement(y,Object.assign({transform:"translate(0,".concat(180===e.tickRotation?-47:23,")")},e)))},v=function(e){var t=e.intInfos,n=e.stnState,r=e.tickRotation,c=Object(a.a)(e,["intInfos","stnState","tickRotation"]);return s.createElement("g",c,t.map((function(e,a){return s.createElement("use",{key:a,xlinkHref:"#inttick",stroke:-1===n?"#aaa":e[2],transform:"translate(".concat(-2*(t.length-1)+4*a,",0)rotate(").concat(180===r?180:0,")")})})))},y=function(e){var t=e.intInfos,n=e.tickRotation,r=e.stnState,c=Object(a.a)(e,["intInfos","tickRotation","stnState"]);return s.createElement("g",c,t.map((function(e,t){return s.createElement("g",{key:t,transform:"translate(0,".concat(28*t*(180===n?-1:1),")")},s.createElement(f,{info:e,stnState:r}))})))},O=n(153),_=function(e,t){return 2===e[t].parents.length||2===e[t].children.length?.25:0},S=function(){var e,t=s.useContext(l.b),n=t.param,r=t.branches,a=t.routes,i=t.deps,o=Object(O.b)(n.stn_list,_,_),m=s.useMemo((function(){return console.log("computing x shares"),Object.keys(n.stn_list).reduce((function(e,t){return Object(u.a)({},e,Object(c.a)({},t,function(e,t,n){var r=Object(O.c)("linestart","lineend",t);if(r.nodes.includes(e))return Object(O.c)(r.nodes[1],e,t).len;for(var a=n.filter((function(t){return t.includes(e)}))[0],c=e;!r.nodes.includes(c);)c=a[a.indexOf(c)-1];for(var i=e;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var s="linestart"===c,l="lineend"===i;if(a.toString()===n[0].toString()){var o=[];return s||l?s?(o[0]=0,o[1]=Object(O.c)(r.nodes[1],i,t).len,o[2]=Object(O.c)(a[1],e,t).len,o[3]=Object(O.c)(e,i,t).len):(o[0]=Object(O.c)(r.nodes[1],c,t).len,o[1]=Object(O.c)(c,r.nodes.slice(-2)[0],t).len,o[2]=Object(O.c)(c,e,t).len,o[3]=Object(O.c)(e,a.slice(-2)[0],t).len):(o[0]=Object(O.c)(r.nodes[1],c,t).len,o[1]=Object(O.c)(c,i,t).len,o[2]=Object(O.c)(c,e,t).len,o[3]=Object(O.c)(e,i,t).len),o[0]+o[2]*o[1]/(o[2]+o[3])}if(s||l)return s?Object(O.c)(r.nodes[1],i,t).len-Object(O.c)(e,i,t).len:Object(O.c)(r.nodes[1],c,t).len+Object(O.c)(c,e,t).len;var u=[];return u[0]=Object(O.c)(r.nodes[1],c,t).len,u[1]=Object(O.c)(c,i,t).len,u[2]=Object(O.c)(c,e,t).len,u[3]=Object(O.c)(e,i,t).len,u[0]+u[2]*u[1]/(u[2]+u[3])}(t,o,r)))}),{})}),[r.toString(),JSON.stringify(o)]),h=Object(O.c)("linestart","lineend",o),d=Object(O.c)(h.nodes[1],h.nodes.slice(-2)[0],o),g="r"===n.direction?[n.svgWidth.railmap*n.padding/100+65,n.svgWidth.railmap*(1-n.padding/100)-20]:[n.svgWidth.railmap*n.padding/100,n.svgWidth.railmap*(1-n.padding/100)-65],p=Object.keys(m).reduce((function(e,t){return Object(u.a)({},e,Object(c.a)({},t,g[0]+m[t]/d.len*(g[1]-g[0])))}),{}),E=s.useMemo((function(){return console.log("computing y shares"),Object.keys(n.stn_list).reduce((function(e,t){if(r[0].includes(t))return Object(u.a)({},e,Object(c.a)({},t,0));var a=r.slice(1).filter((function(e){return e.includes(t)}))[0];return Object(u.a)({},e,Object(c.a)({},t,n.stn_list[a[0]].children.indexOf(a[1])?-2:2))}),{})}),[i]),b=Object.keys(E).reduce((function(e,t){return Object(u.a)({},e,Object(c.a)({},t,-E[t]*n.branch_spacing))}),{}),x=s.useMemo((function(){return Object(O.e)(n.current_stn_idx,a,n.direction)}),[n.current_stn_idx,n.direction,a.toString()]),v=Object(O.d)(r,x),y=Object.keys(v).reduce((function(e,t){return Object(u.a)({},e,Object(c.a)({},t,v[t].map((function(e){return k(e,p,b)}))))}),{});return s.createElement("g",{id:"main",style:(e={},Object(c.a)(e,"--y-percentage",n.y_pc),Object(c.a)(e,"transform","translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"),e)},s.createElement(j,{paths:y}),s.createElement(z,{xs:p,ys:b,stnStates:x}),s.createElement("g",{id:"line_name",style:Object(c.a)({},"--translate-x","r"==n.direction?"".concat(g[0]-65,"px"):"".concat(g[1]+65,"px"))},s.createElement(f,{info:[,,"var(--rmg-theme-colour)","var(--rmg-theme-fg)",n.line_name[0],n.line_name[1]],stnState:1})))},j=s.memo((function(e){return s.createElement("g",{fill:"none",strokeWidth:4},s.createElement("g",{stroke:"#aaa",strokeDasharray:4},e.paths.pass.map((function(e,t){return s.createElement("path",{key:t,d:e})}))),s.createElement("g",{stroke:"var(--rmg-theme-colour)"},e.paths.main.map((function(e,t){return s.createElement("path",{key:t,d:e})}))))}),(function(e,t){return JSON.stringify(e.paths)===JSON.stringify(t.paths)})),k=function(e,t,n){var r,a=[];return e.forEach((function(e){var c=t[e],i=n[e];if(!r&&0!==r)return r=i,void a.push("M ".concat(c,",").concat(i));0===i?(i<r&&a.push("H ".concat(c-40),"a 40,40 0 0,0 40,-40","V ".concat(i)),i>r&&a.push("H ".concat(c-40),"a 40,40 0 0,1 40,40","V ".concat(i))):(i<r&&a.push("V ".concat(i+40),"a 40,40 0 0,1 40,-40","H ".concat(c)),i>r&&a.push("V ".concat(i-40),"a 40,40 0 0,0 40,40","H ".concat(c))),a.push("H ".concat(c)),r=i})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},z=function(e){var t=s.useContext(l.b).param;return s.createElement("g",{id:"stn_icons"},Object.keys(t.stn_list).map((function(t){if(!["linestart","lineend"].includes(t))return s.createElement("g",{key:t,style:{transform:"translate(".concat(e.xs[t],"px,").concat(e.ys[t],"px)")}},s.createElement(g,{stnId:t,stnState:e.stnStates[t],stnY:e.ys[t]}))})))},w=(t.default=function(){var e=s.useContext(l.b).param;return s.createElement(s.Fragment,null,s.createElement(w,null),s.createElement(o.a,{variant:e.info_panel_type,isShowLight:!1,isShowPSD:!1}),"l"===e.direction&&e.stn_list[e.current_stn_idx].parents.includes("linestart")||"r"===e.direction&&e.stn_list[e.current_stn_idx].children.includes("lineend")?s.createElement(L,null):s.createElement(s.Fragment,null,s.createElement(S,null),s.createElement(N,null),e.notesGZMTR.map((function(e,t){return s.createElement(H,{key:t,note:e})}))))},s.memo((function(){return s.createElement("defs",null,s.createElement("path",{id:"stn",className:"rmg-stn",d:"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 "}),s.createElement("path",{id:"stn_pass",stroke:"#aaa",fill:"#fff",strokeWidth:2,d:"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 "}),s.createElement("path",{id:"arrow_direction",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black"}),s.createElement("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),s.createElement("rect",{id:"intbox",x:-22.5,height:24,width:45,rx:4.5}))}))),N=function(){var e,t=s.useContext(l.b),n=t.param,r=t.routes,a=s.useMemo((function(){return Object(i.a)(new Set(r.reduce((function(e,t){return t.includes(n.current_stn_idx)?e.concat(t.filter((function(e){return!["linestart","lineend"].includes(e)})).slice("l"===n.direction?0:-1)[0]):e}),[])))}),[n.current_stn_idx,n.direction,r.toString()]),o={textAnchor:"l"===n.direction?"start":"end",transform:"translate(".concat("l"===n.direction?65:-65,",-5)"),destIds:a};return s.createElement("g",{id:"direction_gz",style:(e={},Object(c.a)(e,"--x-percentage",n.direction_gz_x),Object(c.a)(e,"--y-percentage",n.direction_gz_y),e)},s.createElement("use",{xlinkHref:"#arrow_direction",style:Object(c.a)({},"--rotate","l"===n.direction?"0deg":"180deg")}),2!==a.length?s.createElement(P,o):s.createElement(M,o))},P=function(e){var t=e.destIds,n=Object(a.a)(e,["destIds"]),r=s.useContext(l.b).param;return s.createElement("g",n,s.createElement("text",{className:"rmg-name__zh",fontSize:28},t.map((function(e){return r.stn_list[e].name[0]})).join("/")+"\u65b9\u5411"),s.createElement("text",{className:"rmg-name__en",fontSize:14,dy:22},"Towards "+t.map((function(e){return r.stn_list[e].name[1].replace("\\"," ")})).join("/")))},M=function(e){var t=e.destIds,n=Object(a.a)(e,["destIds"]),r=s.useContext(l.b).param,c=t.map((function(e){return r.stn_list[e].name[0].length})),o=Math.min.apply(Math,Object(i.a)(c)),u=o>1&&c[0]!==c[1]?Math.abs(c[0]-c[1])/(o-1):0;return s.createElement("g",n,t.map((function(e,t){return s.createElement(s.Fragment,{key:e},s.createElement("text",{className:"rmg-name__zh",fontSize:25,x:"l"===r.direction?0:-75,y:42*t-21,letterSpacing:c[t]>c[1-t]?"0em":"".concat(u,"em")},r.stn_list[e].name[0]),s.createElement("text",{className:"rmg-name__en",fontSize:11.5,x:"l"===r.direction?0:-75,y:42*t-1},"Towards "+r.stn_list[e].name[1].replace("\\"," ")))})),s.createElement("text",{className:"rmg-name__zh",fontSize:28,x:"l"===r.direction?25*(Math.max.apply(Math,Object(i.a)(c))+1):0,y:5},"\u65b9\u5411"))},L=s.memo((function(){return s.createElement("g",{id:"terminus_gz",textAnchor:"middle"},s.createElement("text",{className:"rmg-name__zh",fontSize:90},"\u7ec8 \u70b9 \u7ad9"),s.createElement("text",{dy:70,className:"rmg-name__en",fontSize:36},"Terminal"),s.createElement("g",{strokeWidth:8,stroke:"#000"},s.createElement("path",{d:"M -160,68 h -160"}),s.createElement("path",{d:"M 160,68 h 160"})))})),H=s.memo((function(e){var t,n=s.useRef(),a=s.useState({width:0,height:0,y:0}),i=Object(r.a)(a,2),l=i[0],o=i[1];return s.useEffect((function(){return o(n.current.getBBox())}),[e.note[0],e.note[1]]),s.createElement("g",{className:"note-box",style:(t={},Object(c.a)(t,"--x-percentage",e.note[2]),Object(c.a)(t,"--y-percentage",e.note[3]),t)},e.note[4]&&s.createElement("rect",{height:l.height+4,width:l.width+4,x:-2,y:l.y-2,fill:"none",stroke:"black",strokeWidth:.5}),s.createElement("g",{ref:n},s.createElement("g",{fontSize:16,letterSpacing:1.2},e.note[0].split("\n").map((function(e,t){return s.createElement("text",{key:t,className:"rmg-name__zh",y:18*t},e)}))),s.createElement("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*e.note[0].split("\n").length,")")},e.note[1].split("\n").map((function(t,n){var r;return s.createElement("text",{key:n,className:"rmg-name__en",y:11*n,textLength:n<(null===(r=e.note[1].match(/\n/g))||void 0===r?void 0:r.length)?l.width:0,lengthAdjust:"spacing"},t)})))))}),(function(e,t){return e.note.toString()===t.note.toString()}))}}]);
//# sourceMappingURL=railmapGZMTR.c87b52c9.chunk.js.map