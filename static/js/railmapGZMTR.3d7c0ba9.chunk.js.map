{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","svgs/railmap/methods/share.ts","svgs/strip/strip-gzmtr.tsx","svgs/station-num-gzmtr.tsx","svgs/railmap/main/line-box-gzmtr.tsx","svgs/railmap/main/station/station-gzmtr.tsx","svgs/railmap/main/main-gzmtr.tsx","svgs/railmap/railmap-gzmtr.tsx"],"names":["_objectWithoutProperties","source","excluded","key","i","target","sourceKeys","Object","keys","length","indexOf","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","adjacencyList","stnList","leftW","rightW","reduce","acc","cur","children","a","c","criticalPathMethod","from","to","adjMat","len","nodes","allLengths","criticalPaths","forEach","child","cp","push","unshift","maxLength","Math","max","getXShareMTR","stnId","branches","criticalPath","includes","branchOfStn","filter","branch","partSource","partSink","leftOpenJaw","lens","slice","getStnState","currentId","routes","direction","console","log","Set","concat","stnId1","stnId2","route","idx1","idx2","_isSuccessor","_isPredecessor","Stations","data","yShares","xShares","namePoss","leftWideFactor","rightWideFactor","pathWeight","Infinity","pathTurnParams","branchSpacing","dy_a","tr","sqrt","dy_l","dx_a","dx_l","pathTurnSE","pathTurnNE","this","protoProps","staticProps","stations","getYShare","getNamePos","stnStates","lineXs","xs","ys","linePaths","main","pass","map","lineMainStns","linePassStns","_linePath","parents","stnPred","res","pos","parId","stnIds","realXs","realYs","prevId","prevY","prevX","path","stnDX","stnExtraH","stnSpareH","warn","x","y","join","replace","drawLine","StripGZMTR","stripHeight","variant","indicatorLight","React","useMemo","cy","r","fill","rx","ry","height","width","id","style","transform","isShowLight","isShowPSD","PSD","memo","className","fontSize","dy","prevProps","nextProps","StationNumberText","lineNum","stnNum","others","lineNumEl","useRef","useState","bBox","setBBox","useEffect","current","getBBox","lineNumScale","stnNumScale","textAnchor","ref","stnState","info","xlinkHref","LineBoxNameSpan","name","LineBoxName","toString","nameZHEl","match","t","isNaN","Number","dominantBaseline","nameZHGroupEl","zhBBox","setZhBBox","nameZHGroupScale","nameENEl","enBBox","setEnBBox","nameENScale","sharedText","idx","nameEl","nameScale","trim","StationGZMTR","param","useContext","ParamContext","stnInfo","stn_list","isNameShift","tickRotation","stnY","left","right","nameENLns","split","nameDX","cos","intInfos","theme","line_name","transfer","stroke","line_num","num","isExpress","services","StationNameGElement","nameDY","stnNameEl","StationName","ExpressTag","forwardRef","txt","IntGroup","strokeWidth","IntTicks","IntBoxs","other","wideFactor","MainGZMTR","deps","rightOpenJaw","getXShare","JSON","stringify","realCP","svgWidth","railmap","padding","branch_spacing","current_stn_idx","paths","stns","y_pc","Line","strokeDasharray","d","StationGroup","DefsGZMTR","RailMapGZMTR","info_panel_type","TerminusFlag","notesGZMTR","note","NoteBox","strokeLinecap","DirectionIndicator","validDests","textGroupProps","destIds","direction_gz_x","direction_gz_y","DirectionIndicatorTextGroup","DirectionIndicatorTextGroup2","charCounts","minCharCounts","min","charSpacing","abs","letterSpacing","noteTextEl","textLength","lengthAdjust"],"mappings":"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","file":"static/js/railmapGZMTR.3d7c0ba9.chunk.js","sourcesContent":["import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import * as Global from '../../../methods';\n\n/**\n * Compute the adjacency list of the graph.\n * @param stnList Key-value pairs of station info\n * @param leftW Callback of left wide factor\n * @param rightW Callback of right wide factor\n */\nexport const adjacencyList = (\n    stnList: { [stnId: string]: StationInfo },\n    leftW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number,\n    rightW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number\n) => {\n    return Object.keys(stnList).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: stnList[cur].children.reduce(\n                (a, c) => ({ ...a, [c]: 1 + leftW(stnList, c) + rightW(stnList, cur) }),\n                {}\n            ),\n        }),\n        {} as { [from: string]: { [to: string]: number } }\n    );\n};\n\n/**\n * Compute critical path and its length from `from` node to `to` node with critical path method.\n * @param from ID of station on the left\n * @param to ID of station on the right\n * @param adjMat Adjacency matrix in the form of `Object` returned from `adjacencyList` method.\n */\nexport const criticalPathMethod = (from: string, to: string, adjMat: ReturnType<typeof adjacencyList>) => {\n    if (from === to) {\n        return { len: 0, nodes: [from] };\n    }\n    let allLengths: number[] = [];\n    let criticalPaths: string[][] = [];\n    Object.keys(adjMat[from]).forEach(child => {\n        let cp = criticalPathMethod(child, to, adjMat);\n        if (cp.len < 0) return;\n        allLengths.push(adjMat[from][child] + cp.len);\n        cp.nodes.unshift(from);\n        criticalPaths.push(cp.nodes);\n    });\n    let maxLength = Math.max(...allLengths);\n    return {\n        len: maxLength,\n        nodes: criticalPaths[allLengths.indexOf(maxLength)],\n    };\n};\n\nexport const getXShareMTR = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]) => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        // expand to fit\n        let lens = [];\n        if (!leftOpenJaw && !rightOpenJaw) {\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else if (leftOpenJaw) {\n            lens[0] = 0;\n            lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n            lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else {\n            // right open jaw\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n        }\n        return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n    }\n};\n\nconst getYShare = (stnId: string, stnList: { [stnId: string]: StationInfo }) => {\n    return Global.getYShareMTR(stnId, stnList);\n};\n\n/**\n * Vertical position (in pixels) of station icon related to vertical position of line.\n */\nexport const getYReal = (stnId: string, param: RMGParam) => {\n    return -getYShare(stnId, param.stn_list) * param.branch_spacing;\n};\n\nconst _isPredecessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx2 !== -1 && idx2 < idx1) return true;\n    }\n    return false;\n};\n\nconst _isSuccessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx1 !== -1 && idx1 < idx2) return true;\n    }\n    return false;\n};\n\nexport const getStnState = (\n    currentId: string,\n    routes: string[][],\n    direction: 'l' | 'r'\n): { [stnId: string]: -1 | 0 | 1 } => {\n    console.log(\"computing stations' states\");\n    return [...new Set(([] as string[]).concat(...routes))].reduce(\n        (acc, cur: string) => ({\n            ...acc,\n            [cur]:\n                cur === currentId\n                    ? 0\n                    : (direction === 'r'\n                        ? _isSuccessor(currentId, cur, routes)\n                        : _isPredecessor(currentId, cur, routes))\n                    ? 1\n                    : -1,\n        }),\n        {}\n    );\n};\n\nexport class Stations {\n    yShares = {} as { [stnId: string]: number };\n    xShares = {} as { [stnId: string]: number };\n    namePoss = {} as { [stnId: string]: boolean };\n    stnList = {} as { [stnId: string]: StationInfo };\n    criticalPath = {} as { len: number; nodes: string[] };\n\n    constructor(data: { stnList?: any; criticalPath?: any }) {\n        this.stnList = data.stnList;\n        this.criticalPath = data.criticalPath;\n    }\n\n    /**\n     * Increment of the weight of in-bound edge of a station, which increases the horizontal interval from its parents.\n     */\n    protected leftWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Increment of the weight of out-bound edge of a station, which increases the horizontal interval from its children.\n     */\n    protected rightWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Path weight from station 1 to station 2 (station 2 must be a child of station 1, otherwise return `-Infinity`).\n     */\n    public pathWeight = (stnId1: string, stnId2: string) => {\n        if (!this.stnList[stnId1].children.includes(stnId2)) {\n            return -Infinity;\n        }\n        return 1 + this.rightWideFactor(stnId1) + this.leftWideFactor(stnId2);\n    };\n\n    protected getYShare(stnId: string, branches?: string[][]): number {\n        if (stnId in this.yShares) return this.yShares[stnId];\n\n        if (\n            ['linestart', 'lineend'].includes(stnId) ||\n            this.stnList[stnId].parents.length > 1 ||\n            this.stnList[stnId].children.length > 1\n        ) {\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n        var stnPred = this.stnList[stnId].parents[0];\n        if (stnPred) {\n            // parent exist\n            if (this.stnList[stnPred].children.length === 1) {\n                // no sibling, then y same as parent\n                let res = this.getYShare(stnPred);\n                this.yShares[stnId] = res;\n                return res;\n            } else {\n                // sibling exists, then y depends on its idx of being children\n                let res: 1 | -1 = this.stnList[stnPred].children.indexOf(stnId) === 0 ? 1 : -1;\n                this.yShares[stnId] = res;\n                return res;\n            }\n        } else {\n            // no parent, must be linestart\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n    }\n\n    static getYShares(stnList: StationDict, branches?: string[][]) {\n        console.log('computing y shares');\n        let stations = new this({ stnList });\n\n        Object.keys(stnList).forEach(stnId => {\n            if (['linestart', 'lineend'].includes(stnId)) return;\n            if (stnId in stations.yShares) return;\n            stations.getYShare(stnId, branches);\n        });\n\n        return stations.yShares;\n    }\n\n    private getNamePos(stnId: string): boolean {\n        if (stnId === 'linestart') {\n            this.namePoss['linestart'] = true;\n            return true;\n        }\n        let self = this;\n        let pos = this.criticalPath.nodes.indexOf(stnId) % 2; // -1, 0 or 1;\n        if (pos === -1) {\n            let parId = this.stnList[stnId].parents[0];\n            if (this.stnList[parId].children.length === 2) {\n                let res = self.getNamePos(parId);\n                this.namePoss[stnId] = res;\n                return res;\n            }\n            let res = !self.getNamePos(parId);\n            this.namePoss[stnId] = res;\n            return res;\n        }\n        this.namePoss[stnId] = pos === 1;\n        return pos === 1;\n    }\n\n    static getNamePos(stnList: StationDict, cp: { len: number; nodes: string[] }) {\n        console.log('computing name position');\n        let stations = new this({ stnList, criticalPath: cp });\n\n        Object.keys(stnList).forEach(stnId => {\n            if (['linestart', 'lineend'].includes(stnId)) return;\n            if (stnId in stations.namePoss) return;\n            stations.getNamePos(stnId);\n        });\n\n        return stations.namePoss;\n    }\n\n    /**\n     * Parameters of the arcs involved in the `<path>` element.\n     */\n    private pathTurnParams = (branchSpacing: number) => {\n        let tr = 35; // turning radius\n        let dx_a = tr / 2; // dx of a\n        let dy_a = tr - dx_a * Math.sqrt(3); // dy of a\n        let dy_l = branchSpacing - 2 * dy_a; // dy of l\n        let dx_l = dy_l * Math.sqrt(3); // dx of l\n        return { tr, dx_a, dy_a, dx_l, dy_l };\n    };\n\n    /**\n     * Path segment from a station towards its southeast (lower-right).\n     */\n    private pathTurnSE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,1 ${dx_a},${dy_a} l ${dx_l},${dy_l} a ${tr},${tr} 0 0,0 ${dx_a},${dy_a}`;\n    };\n\n    /**\n     * Path segment from a station towards its northeast (upper-right).\n     */\n    private pathTurnNE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,0 ${dx_a},${-dy_a} l ${dx_l},${-dy_l} a ${tr},${tr} 0 0,1 ${dx_a},${-dy_a}`;\n    };\n\n    /**\n     * Generate `d` attribute of `<path>` element through all stations input.\n     */\n    protected _linePath(\n        stnIds: string[],\n        lineXs: [number, number],\n        branches: string[][],\n        realXs: { [stnId: string]: number },\n        realYs: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] }\n    ) {\n        var [prevId, prevY, prevX] = ([] as unknown) as [string, number, number];\n        var path = [] as string[];\n\n        let { dx_a, dx_l } = this.pathTurnParams(branchSpacing);\n        let stnDX = dx_a + dx_l / 2;\n        let stnExtraH = ((lineXs[1] - lineXs[0]) / cp.len) * 0.8;\n        let stnSpareH = ((lineXs[1] - lineXs[0]) / cp.len - 2 * stnDX) / 2;\n        if (stnSpareH + stnExtraH < 0) {\n            console.warn(`SVG width too small! ${stnSpareH + stnExtraH}`);\n        }\n\n        stnIds.forEach(stnId => {\n            let x = realXs[stnId];\n            let y = realYs[stnId];\n            if (!prevY && prevY !== 0) {\n                [prevId, prevX, prevY] = [stnId, x, y];\n                if (stnIds.length === 1) {\n                    path.push(`M ${x},${y}`);\n                } else if (!branches[0].includes(stnId)) {\n                    // started from branch\n                    path.push(`M ${x},${y}`);\n                } else if (branches[0].includes(stnIds[1])) {\n                    // started from branching station, this is main line\n                    path.push(`M ${x},${y}`);\n                } else {\n                    // started form branching station, this is branch line\n                    if (realXs[stnIds[1]] > 0) {\n                        path.push(`M ${x},${y + 9.68}`);\n                    }\n                    if (realYs[stnIds[1]] < 0) {\n                        path.push(`M ${x},${y - 9.68}`);\n                    }\n                }\n                return;\n            }\n            if (y > prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnSE(branchSpacing));\n            } else if (y < prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnNE(branchSpacing));\n            }\n            path.push(`H ${x}`);\n            [prevId, prevX, prevY] = [stnId, x, y];\n        });\n\n        // simplify path\n        return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n    }\n\n    static drawLine(\n        branches: string[][],\n        stnStates: { [stnId: string]: -1 | 0 | 1 },\n        stnList: { [stnId: string]: StationInfo },\n        lineXs: [number, number],\n        xs: { [stnId: string]: number },\n        ys: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] }\n    ) {\n        let linePaths = { main: [] as string[], pass: [] as string[] };\n        branches.map((branch, i) => {\n            branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n            var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n            var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n            if (lineMainStns.length === 1) {\n                linePassStns = branch;\n            }\n\n            if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n                // if two set disjoint\n                if (linePassStns[0] === branch[0]) {\n                    // -1 -1 1 1\n                    linePassStns.push(lineMainStns[0]);\n                } else if (\n                    lineMainStns[0] === branch[0] &&\n                    lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                    linePassStns.length\n                ) {\n                    linePassStns = branch;\n                    lineMainStns = [];\n                } else {\n                    // 1 1 -1 -1\n                    linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n                }\n            }\n\n            linePaths.main.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    lineMainStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp\n                )\n            );\n            linePaths.pass.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    linePassStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp\n                )\n            );\n        });\n\n        return linePaths;\n    }\n}\n\nexport const drawLine = (branches: string[][], stnStates: { [stnId: string]: -1 | 0 | 1 }) => {\n    let linePaths = { main: [] as string[][], pass: [] as string[][] };\n    branches.map(branch => {\n        branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n        var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n        var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n        if (lineMainStns.length === 1) {\n            linePassStns = branch;\n        }\n\n        if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n            // if two set disjoint\n            if (linePassStns[0] === branch[0]) {\n                // -1 -1 1 1\n                linePassStns.push(lineMainStns[0]);\n            } else if (\n                lineMainStns[0] === branch[0] &&\n                lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                linePassStns.length\n            ) {\n                linePassStns = branch;\n                lineMainStns = [];\n            } else {\n                // 1 1 -1 -1\n                linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n            }\n        }\n\n        linePaths.main.push(lineMainStns);\n        linePaths.pass.push(linePassStns);\n    });\n\n    return linePaths;\n};\n","import React from 'react';\n\ninterface Props {\n    variant: 'gz1' | 'gz28' | 'gz3' | 'gz1421' | 'gzgf';\n    isShowLight: boolean;\n    isShowPSD: false | string;\n}\n\nconst StripGZMTR = (props: Props) => {\n    const stripHeight = (variant => {\n        switch (variant) {\n            case 'gz28':\n            case 'gzgf':\n                return 60;\n            case 'gz1':\n            case 'gz3':\n                return 40;\n            case 'gz1421':\n                return 20;\n            default:\n                return 0;\n        }\n    })(props.variant);\n\n    const indicatorLight = React.useMemo(() => {\n        switch (props.variant) {\n            case 'gz1':\n                return <circle cy={-28} r={16} fill=\"red\" />;\n            case 'gz28':\n                return <ellipse rx={24} ry={12} fill=\"orange\" />;\n            case 'gz3':\n                return <rect x={-15} y={-25} height={30} width={30} fill=\"red\" />;\n            case 'gzgf':\n                return <ellipse rx={24} ry={12} fill=\"white\" />;\n            case 'gz1421':\n                return <ellipse cy={-8} rx={24} ry={12} fill=\"orange\" />;\n            default:\n                return <></>;\n        }\n    }, [props.variant]);\n\n    return (\n        <g>\n            <rect\n                id=\"strip_gz\"\n                style={{\n                    ['--height' as any]: `${stripHeight}px`,\n                }}\n            />\n            <g\n                style={{\n                    transform: 'translate(calc(var(--rmg-svg-width) / 2),calc(var(--rmg-svg-height) - 30px))',\n                }}\n            >\n                {props.isShowLight && indicatorLight}\n            </g>\n            {props.isShowPSD && <PSD {...props} />}\n        </g>\n    );\n};\n\nexport default StripGZMTR;\n\nconst PSD = React.memo(\n    (props: Props) => (\n        <g\n            id=\"big_psd\"\n            fill={['gz3', 'gz1421', 'gz1'].includes(props.variant) ? 'var(--rmg-theme-fg)' : '#000'}\n            style={{\n                ['--psd-dy' as any]: ['gz1', 'gz3'].includes(props.variant)\n                    ? '82px'\n                    : props.variant === 'gz1421'\n                    ? '62px'\n                    : '58px',\n            }}\n        >\n            <rect\n                height={40}\n                width={40}\n                rx={4}\n                x={-20}\n                fill={['gz3', 'gz1421', 'gz1'].includes(props.variant) ? 'var(--rmg-theme-colour)' : '#fff'}\n            />\n            <text className=\"rmg-name__en\" fontSize={20} dy={12}>\n                {props.isShowPSD}\n            </text>\n            <text className=\"rmg-name__zh\" fontSize={12} dy={26}>\n                \n            </text>\n            <text className=\"rmg-name__en\" fontSize={6.5} dy={36}>\n                Screen Door\n            </text>\n        </g>\n    ),\n    (prevProps, nextProps) => prevProps.variant === nextProps.variant && prevProps.isShowPSD === nextProps.isShowPSD\n);\n","import React from 'react';\n\nconst StationNumberText = (props: { lineNum: string; stnNum: string } & React.SVGProps<SVGGElement>) => {\n    const { lineNum, stnNum, ...others } = props;\n\n    const LINE_NUM_MAX_WIDTH = 15.03125;\n\n    const lineNumEl = React.useRef<SVGTextElement | null>(null);\n    const [bBox, setBBox] = React.useState({ width: LINE_NUM_MAX_WIDTH } as DOMRect);\n    React.useEffect(() => setBBox(lineNumEl.current!.getBBox()), [lineNum]);\n\n    const lineNumScale = bBox.width > LINE_NUM_MAX_WIDTH ? LINE_NUM_MAX_WIDTH / bBox.width : 1;\n    const stnNumScale = lineNum.length === 2 ? lineNumScale : 1;\n\n    return (\n        <g textAnchor=\"middle\" fontSize={13.5} {...others}>\n            {React.useMemo(\n                () => (\n                    <>\n                        <g transform={`translate(-9.25,0)scale(${lineNumScale})`}>\n                            <text ref={lineNumEl} className=\"rmg-name__zh\">\n                                {lineNum}\n                            </text>\n                        </g>\n                        <g transform={`translate(9.25,0)scale(${stnNumScale})`}>\n                            <text className=\"rmg-name__zh\">{stnNum}</text>\n                        </g>\n                    </>\n                ),\n                [bBox.width, lineNum, stnNum]\n            )}\n        </g>\n    );\n};\n\nexport default StationNumberText;\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport default React.memo(\n    function LineBox(props: { info: InterchangeInfo; stnState: -1 | 0 | 1 }) {\n        return (\n            <g textAnchor=\"middle\" fill={props.stnState === -1 ? '#fff' : props.info[3]}>\n                <use xlinkHref=\"#intbox\" fill={props.stnState === -1 ? '#aaa' : props.info[2]} />\n                {props.info[4][0] === props.info[5][0] ? (\n                    <LineBoxNameSpan name={props.info.slice(-2) as Name} />\n                ) : (\n                    <LineBoxName name={props.info.slice(-2) as Name} />\n                )}\n            </g>\n        );\n    },\n    (prevProps, nextProps) =>\n        prevProps.info.toString() === nextProps.info.toString() && prevProps.stnState === nextProps.stnState\n);\n\nconst LineBoxName = React.memo(\n    (props: { name: Name }) => {\n        let nameZHEl = [] as JSX.Element[];\n        let dy = 0;\n        props.name[0].match(/\\d+|\\D+/g)?.forEach((t, i) => {\n            if (isNaN(Number(t))) {\n                // text\n                nameZHEl.push(\n                    <tspan key={i} dominantBaseline=\"hanging\" dy={1 - dy}>\n                        {t}\n                    </tspan>\n                );\n                dy += 1 - dy;\n            } else {\n                // number\n                nameZHEl.push(\n                    <tspan key={i} dominantBaseline=\"hanging\" fontSize={16} dy={-dy}>\n                        {t}\n                    </tspan>\n                );\n                dy = 0;\n            }\n        });\n\n        const nameZHGroupEl = useRef<SVGTextElement | null>(null);\n        const [zhBBox, setZhBBox] = useState({ width: 0 } as DOMRect);\n        useEffect(() => setZhBBox(nameZHGroupEl.current!.getBBox()), [props.name[0]]);\n        const nameZHGroupScale = zhBBox.width > 43.5 ? 43.5 / zhBBox.width : 1;\n\n        const nameENEl = useRef<SVGTextElement | null>(null);\n        const [enBBox, setEnBBox] = useState({ width: 0 } as DOMRect);\n        useEffect(() => setEnBBox(nameENEl.current!.getBBox()), [props.name[1]]);\n        const nameENScale = enBBox.width > 43.5 ? 43.5 / enBBox.width : 1;\n\n        return (\n            <>\n                <text\n                    ref={nameZHGroupEl}\n                    y={2}\n                    className=\"rmg-name__zh\"\n                    fontSize={12}\n                    transform={`scale(${nameZHGroupScale},1)`}\n                >\n                    {nameZHEl}\n                </text>\n                <text\n                    ref={nameENEl}\n                    y={19.5}\n                    fontSize={props.name[1].replace('\\\\', ' ').length > 10 ? 7 : 8}\n                    className=\"rmg-name__en\"\n                    transform={`scale(${nameENScale},1)`}\n                >\n                    {props.name[1]}\n                </text>\n            </>\n        );\n    },\n    (prevProps, nextProps) => prevProps.name.toString() === nextProps.name.toString()\n);\n\nconst LineBoxNameSpan = React.memo(\n    (props: { name: Name }) => {\n        let sharedText = '';\n        for (let idx in [...props.name[0]]) {\n            if (props.name[0][idx] === props.name[1][idx]) {\n                sharedText += props.name[0][idx];\n            } else {\n                break;\n            }\n        }\n\n        const nameEl = useRef<SVGTextElement | null>(null);\n        const [bBox, setBBox] = useState({ x: 0, width: 0 } as DOMRect);\n        useEffect(() => setBBox(nameEl.current!.getBBox()), [props.name.toString()]);\n\n        const nameScale = bBox.width > 43.5 ? 43.5 / bBox.width : 1;\n\n        // unsymmetrical scaling, wrap with <g>\n        return (\n            <g transform={`scale(${nameScale},1)`}>\n                <g transform={`translate(${-bBox.x - bBox.width / 2},0)`}>\n                    <text ref={nameEl} className=\"rmg-name__zh\" fontSize={14} y={12} textAnchor=\"end\">\n                        {sharedText}\n                        <tspan className=\"rmg-name__zh\" fontSize={8} x={0} dy={-2} textAnchor=\"start\">\n                            {props.name[0].slice(sharedText.length)}\n                        </tspan>\n                        <tspan className=\"rmg-name__en\" fontSize={4} x={0} dy={6} textAnchor=\"start\">\n                            {props.name[1].slice(sharedText.length).trim()}\n                        </tspan>\n                    </text>\n                </g>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => prevProps.name.toString() === nextProps.name.toString()\n);\n","import React, { useContext, useState, useEffect, useRef, useMemo } from 'react';\nimport { ParamContext } from '../../../../context';\nimport StationNumberText from '../../../station-num-gzmtr';\nimport LineBox from '../line-box-gzmtr';\n\ninterface Props {\n    stnId: string;\n    stnState: -1 | 0 | 1;\n    stnY: number;\n}\n\nconst StationGZMTR = (props: Props) => {\n    const { param } = useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n\n    const isNameShift = stnInfo.parents.length === 2 || stnInfo.children.length === 2;\n    const tickRotation =\n        props.stnY > 0\n            ? 180\n            : stnInfo.parents.indexOf(stnInfo.branch.left[1] || '') === 1 ||\n              stnInfo.children.indexOf(stnInfo.branch.right[1] || '') === 1\n            ? 180\n            : 0;\n    const nameENLns = stnInfo.name[1].split('\\\\').length;\n    const nameDX = isNameShift\n        ? tickRotation === 180\n            ? 16 + (nameENLns - 1) * 12 * Math.cos(-45)\n            : -9\n        : tickRotation === 180\n        ? -6\n        : (25 + (nameENLns - 1) * 15) * Math.cos(-45);\n\n    return (\n        <>\n            <IntGroup\n                intInfos={\n                    isNameShift\n                        ? (([\n                              [\n                                  param.theme[0],\n                                  param.theme[1],\n                                  'var(--rmg-theme-colour)',\n                                  'var(--rmg-theme-fg)',\n                                  param.line_name[0],\n                                  param.line_name[1],\n                              ],\n                          ] as any[]) as InterchangeInfo[]).concat(stnInfo.transfer.info[0])\n                        : stnInfo.transfer.info[0]\n                }\n                stnState={props.stnState}\n                tickRotation={tickRotation}\n            />\n            <g>\n                <use xlinkHref=\"#stn\" stroke={props.stnState === -1 ? '#aaa' : 'var(--rmg-theme-colour)'} />\n                <StationNumberText\n                    className={`Name ${props.stnState === -1 ? 'Pass' : 'Future'}`}\n                    lineNum={param.line_num}\n                    stnNum={stnInfo.num}\n                />\n            </g>\n            <g style={{ transform: `translateX(${-nameDX}px)` }}>\n                <StationNameGElement\n                    name={stnInfo.name}\n                    stnState={props.stnState}\n                    tickRotation={tickRotation}\n                    isExpress={stnInfo.services.includes('express')}\n                />\n            </g>\n        </>\n    );\n};\n\nexport default StationGZMTR;\n\ninterface StationNameGElementProps {\n    name: Name;\n    stnState: -1 | 0 | 1;\n    tickRotation: 0 | 180;\n    isExpress: boolean;\n}\n\nconst StationNameGElement = (props: StationNameGElementProps) => {\n    const nameDY = props.tickRotation === 180 ? 17.5 : -20 - props.name[1].split('\\\\').length * 14 * Math.cos(-45);\n\n    const stnNameEl = useRef<SVGGElement | null>(null);\n    const [bBox, setBBox] = useState({ width: 0 } as DOMRect);\n    useEffect(\n        () => setBBox(stnNameEl.current!.getBBox()),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.name.toString()]\n    );\n\n    return (\n        <g\n            textAnchor={props.tickRotation === 180 ? 'end' : 'start'}\n            className={`Name ${props.stnState === -1 ? 'Pass' : props.stnState === 0 ? 'CurrentGZ' : 'Future'}`}\n            transform={`translate(0,${nameDY})rotate(-45)`}\n        >\n            <StationName ref={stnNameEl} name={props.name} />\n\n            {props.isExpress && (\n                <ExpressTag\n                    fill={props.stnState === -1 ? '#aaa' : 'var(--rmg-theme-colour)'}\n                    transform={`translate(${(bBox.width + 35) * (props.tickRotation === 180 ? -1 : 1)},${2 +\n                        5 * (props.name[1].split('\\\\').length - 1)})`}\n                />\n            )}\n        </g>\n    );\n};\n\nconst StationName = React.forwardRef((props: { name: Name }, ref: React.Ref<SVGGElement>) =>\n    useMemo(\n        () => (\n            <g ref={ref}>\n                <text className=\"rmg-name__zh\" fontSize={18}>\n                    {props.name[0]}\n                </text>\n                <g fontSize={10.5}>\n                    {props.name[1].split('\\\\').map((txt, i) => (\n                        <text key={i} className=\"rmg-name__en\" dy={16 + i * 11}>\n                            {txt}\n                        </text>\n                    ))}\n                </g>\n            </g>\n        ),\n        [props.name[0], props.name[1]]\n    )\n);\n\nconst ExpressTag = React.memo((props: React.SVGProps<SVGGElement>) => (\n    <g textAnchor=\"middle\" {...props}>\n        <text className=\"rmg-name__zh\" fontSize={13}>\n            \n        </text>\n        <text dy={10} className=\"rmg-name__en\" fontSize={6.5}>\n            Express Station\n        </text>\n    </g>\n));\n\ninterface IntGroupProps {\n    intInfos: InterchangeInfo[];\n    stnState: -1 | 0 | 1;\n    tickRotation: 0 | 180;\n}\n\nconst IntGroup = (props: IntGroupProps) => (\n    <>\n        <IntTicks strokeWidth={4} {...props} />\n        <IntBoxs transform={`translate(0,${props.tickRotation === 180 ? -47 : 23})`} {...props} />\n    </>\n);\n\nconst IntTicks = (props: IntGroupProps & React.SVGProps<SVGGElement>) => {\n    const { intInfos, stnState, tickRotation, ...others } = props;\n\n    return (\n        <g {...others}>\n            {intInfos.map((info, i) => (\n                <use\n                    key={i}\n                    xlinkHref=\"#inttick\"\n                    stroke={stnState === -1 ? '#aaa' : info[2]}\n                    transform={`translate(${-2 * (intInfos.length - 1) + 4 * i},0)rotate(${\n                        tickRotation === 180 ? 180 : 0\n                    })`}\n                />\n            ))}\n        </g>\n    );\n};\n\nconst IntBoxs = (props: IntGroupProps & React.SVGProps<SVGGElement>) => {\n    const { intInfos, tickRotation, stnState, ...other } = props;\n\n    return (\n        <g {...other}>\n            {intInfos.map((info, i) => (\n                <g key={i} transform={`translate(0,${i * 28 * (tickRotation === 180 ? -1 : 1)})`}>\n                    <LineBox info={info} stnState={stnState} />\n                </g>\n            ))}\n        </g>\n    );\n};\n","import React from 'react';\nimport { ParamContext } from '../../../context';\nimport StationGZMTR from './station/station-gzmtr';\nimport LineBox from './line-box-gzmtr';\nimport { adjacencyList, criticalPathMethod, drawLine, getStnState } from '../methods/share';\n\nconst wideFactor = (stnList: { [stnId: string]: StationInfo }, stnId: string) =>\n    stnList[stnId].parents.length === 2 || stnList[stnId].children.length === 2 ? 0.25 : 0;\n\nconst getXShare = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]): number => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        if (branchOfStn.toString() === branches[0].toString()) {\n            // station on main line, expand to fit\n            let lens = [];\n            if (!leftOpenJaw && !rightOpenJaw) {\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n            } else if (leftOpenJaw) {\n                lens[0] = 0;\n                lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n                lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n            } else {\n                // right open jaw\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n            }\n            return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n        } else {\n            if (!leftOpenJaw && !rightOpenJaw) {\n                let lens = [];\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n                return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n            } else if (leftOpenJaw) {\n                return (\n                    criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len -\n                    criticalPathMethod(stnId, partSink, adjMat).len\n                );\n            } else {\n                // right open jaw\n                return (\n                    criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len +\n                    criticalPathMethod(partSource, stnId, adjMat).len\n                );\n            }\n        }\n    }\n};\n\nconst MainGZMTR = () => {\n    const { param, branches, routes, deps } = React.useContext(ParamContext);\n\n    const adjMat = adjacencyList(param.stn_list, wideFactor, wideFactor);\n\n    const xShares = React.useMemo(\n        () => {\n            console.log('computing x shares');\n            return Object.keys(param.stn_list).reduce(\n                (acc, cur) => ({ ...acc, [cur]: getXShare(cur, adjMat, branches) }),\n                {} as { [stnId: string]: number }\n            );\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [branches.toString(), JSON.stringify(adjMat)]\n    );\n\n    const criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    const realCP = criticalPathMethod(criticalPath.nodes[1], criticalPath.nodes.slice(-2)[0], adjMat);\n\n    const lineXs: [number, number] =\n        param.direction === 'r'\n            ? [\n                  (param.svgWidth.railmap * param.padding) / 100 + 65,\n                  param.svgWidth.railmap * (1 - param.padding / 100) - 20,\n              ]\n            : [(param.svgWidth.railmap * param.padding) / 100, param.svgWidth.railmap * (1 - param.padding / 100) - 65];\n    const xs = Object.keys(xShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: lineXs[0] + (xShares[cur] / realCP.len) * (lineXs[1] - lineXs[0]) }),\n        {} as typeof xShares\n    );\n\n    const yShares = React.useMemo(\n        () => {\n            console.log('computing y shares');\n            return Object.keys(param.stn_list).reduce((acc, cur) => {\n                if (branches[0].includes(cur)) {\n                    return { ...acc, [cur]: 0 };\n                } else {\n                    let branchOfStn = branches.slice(1).filter(branch => branch.includes(cur))[0];\n                    return { ...acc, [cur]: param.stn_list[branchOfStn[0]].children.indexOf(branchOfStn[1]) ? -2 : 2 };\n                }\n            }, {} as { [stnId: string]: number });\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [deps]\n    );\n    const ys = Object.keys(yShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: -yShares[cur] * param.branch_spacing }),\n        {} as typeof yShares\n    );\n\n    const stnStates = React.useMemo(() => getStnState(param.current_stn_idx, routes, param.direction), [\n        param.current_stn_idx,\n        param.direction,\n        routes.toString(),\n    ]);\n\n    const linePaths = drawLine(branches, stnStates);\n    const paths = (Object.keys(linePaths) as (keyof ReturnType<typeof drawLine>)[]).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: linePaths[cur].map(stns => _linePath(stns, xs, ys)),\n        }),\n        {} as { [key in keyof ReturnType<typeof drawLine>]: string[] }\n    );\n\n    return (\n        <g\n            id=\"main\"\n            style={{\n                ['--y-percentage' as any]: param.y_pc,\n                transform: 'translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))',\n            }}\n        >\n            <Line paths={paths} />\n            <StationGroup xs={xs} ys={ys} stnStates={stnStates} />\n            <g\n                id=\"line_name\"\n                style={{\n                    ['--translate-x' as any]: param.direction == 'r' ? `${lineXs[0] - 65}px` : `${lineXs[1] + 65}px`,\n                }}\n            >\n                <LineBox\n                    info={\n                        ([\n                            ,\n                            ,\n                            'var(--rmg-theme-colour)',\n                            'var(--rmg-theme-fg)',\n                            param.line_name[0],\n                            param.line_name[1],\n                        ] as any) as InterchangeInfo\n                    }\n                    stnState={1}\n                />\n            </g>\n        </g>\n    );\n};\n\nexport default MainGZMTR;\n\nconst Line = React.memo(\n    (props: { paths: { main: string[]; pass: string[] } }) => (\n        <g fill=\"none\" strokeWidth={4}>\n            <g stroke=\"#aaa\" strokeDasharray={4}>\n                {props.paths.pass.map((path, i) => (\n                    <path key={i} d={path} />\n                ))}\n            </g>\n            <g stroke=\"var(--rmg-theme-colour)\">\n                {props.paths.main.map((path, i) => (\n                    <path key={i} d={path} />\n                ))}\n            </g>\n        </g>\n    ),\n    (prevProps, nextProps) => JSON.stringify(prevProps.paths) === JSON.stringify(nextProps.paths)\n);\n\nconst _linePath = (stnIds: string[], realXs: { [stnId: string]: number }, realYs: { [stnId: string]: number }) => {\n    let prevY: number;\n    var path = [] as string[];\n\n    stnIds.forEach(stnId => {\n        let x = realXs[stnId];\n        let y = realYs[stnId];\n        if (!prevY && prevY !== 0) {\n            prevY = y;\n            path.push(`M ${x},${y}`);\n            return;\n        }\n        if (y === 0) {\n            if (y < prevY) path.push(`H ${x - 40}`, 'a 40,40 0 0,0 40,-40', `V ${y}`);\n            if (y > prevY) path.push(`H ${x - 40}`, 'a 40,40 0 0,1 40,40', `V ${y}`);\n        } else {\n            if (y < prevY) path.push(`V ${y + 40}`, 'a 40,40 0 0,1 40,-40', `H ${x}`);\n            if (y > prevY) path.push(`V ${y - 40}`, 'a 40,40 0 0,0 40,40', `H ${x}`);\n        }\n        path.push(`H ${x}`);\n        prevY = y;\n    });\n\n    // simplify path\n    return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n};\n\ninterface StationGroupProps {\n    xs: { [stnId: string]: number };\n    ys: { [stnId: string]: number };\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n}\n\nconst StationGroup = (props: StationGroupProps) => {\n    const { param } = React.useContext(ParamContext);\n\n    return (\n        <g id=\"stn_icons\">\n            {Object.keys(param.stn_list).map(stnId => {\n                if (['linestart', 'lineend'].includes(stnId)) return;\n                return (\n                    <g\n                        key={stnId}\n                        style={{\n                            transform: `translate(${props.xs[stnId]}px,${props.ys[stnId]}px)`,\n                        }}\n                    >\n                        <StationGZMTR stnId={stnId} stnState={props.stnStates[stnId]} stnY={props.ys[stnId]} />\n                    </g>\n                );\n            })}\n        </g>\n    );\n};\n","import * as React from 'react';\nimport { ParamContext } from '../../context';\nimport StripGZMTR from '../strip/strip-gzmtr';\nimport MainGZMTR from './main/main-gzmtr';\n\nconst RailMapGZMTR = () => {\n    const { param } = React.useContext(ParamContext);\n    return (\n        <>\n            <DefsGZMTR />\n\n            <StripGZMTR variant={param.info_panel_type} isShowLight={false} isShowPSD={false} />\n\n            {(param.direction === 'l' && param.stn_list[param.current_stn_idx].parents.includes('linestart')) ||\n            (param.direction === 'r' && param.stn_list[param.current_stn_idx].children.includes('lineend')) ? (\n                <TerminusFlag />\n            ) : (\n                <>\n                    <MainGZMTR />\n                    <DirectionIndicator />\n                    {param.notesGZMTR.map((note, i) => (\n                        <NoteBox key={i} note={note} />\n                    ))}\n                </>\n            )}\n        </>\n    );\n};\n\nexport default RailMapGZMTR;\n\nconst DefsGZMTR = React.memo(() => (\n    <defs>\n        <path\n            id=\"stn\"\n            className=\"rmg-stn\"\n            d=\"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 \"\n        />\n        <path\n            id=\"stn_pass\"\n            stroke=\"#aaa\"\n            fill=\"#fff\"\n            strokeWidth={2}\n            d=\"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 \"\n        />\n        <path id=\"arrow_direction\" d=\"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z\" fill=\"black\" />\n\n        <path id=\"inttick\" d=\"M 0,0 v 18\" strokeLinecap=\"square\" />\n        <rect id=\"intbox\" x={-22.5} height={24} width={45} rx={4.5} />\n    </defs>\n));\n\nconst DirectionIndicator = () => {\n    const { param, routes } = React.useContext(ParamContext);\n\n    const validDests = React.useMemo(\n        () => [\n            ...new Set(\n                routes.reduce(\n                    (acc, cur) =>\n                        cur.includes(param.current_stn_idx)\n                            ? acc.concat(\n                                  cur\n                                      .filter(stnId => !['linestart', 'lineend'].includes(stnId))\n                                      .slice(param.direction === 'l' ? 0 : -1)[0]\n                              )\n                            : acc,\n                    []\n                )\n            ),\n        ],\n        [param.current_stn_idx, param.direction, routes.toString()]\n    );\n\n    const textGroupProps: TextGroupProps = {\n        textAnchor: param.direction === 'l' ? 'start' : 'end',\n        transform: `translate(${param.direction === 'l' ? 65 : -65},-5)`,\n        destIds: validDests,\n    };\n\n    return (\n        <g\n            id=\"direction_gz\"\n            style={{ ['--x-percentage' as any]: param.direction_gz_x, ['--y-percentage' as any]: param.direction_gz_y }}\n        >\n            <use\n                xlinkHref=\"#arrow_direction\"\n                style={{ ['--rotate' as any]: param.direction === 'l' ? '0deg' : '180deg' }}\n            />\n\n            {validDests.length !== 2 ? (\n                <DirectionIndicatorTextGroup {...textGroupProps} />\n            ) : (\n                <DirectionIndicatorTextGroup2 {...textGroupProps} />\n            )}\n        </g>\n    );\n};\n\ntype TextGroupProps = {\n    destIds: string[];\n} & React.SVGProps<SVGGElement>;\n\nconst DirectionIndicatorTextGroup = (props: TextGroupProps) => {\n    const { destIds, ...others } = props;\n    const { param } = React.useContext(ParamContext);\n    return (\n        <g {...others}>\n            <text className=\"rmg-name__zh\" fontSize={28}>\n                {destIds.map(stnId => param.stn_list[stnId].name[0]).join('/') + ''}\n            </text>\n            <text className=\"rmg-name__en\" fontSize={14} dy={22}>\n                {'Towards ' + destIds.map(stnId => param.stn_list[stnId].name[1].replace('\\\\', ' ')).join('/')}\n            </text>\n        </g>\n    );\n};\n\nconst DirectionIndicatorTextGroup2 = (props: TextGroupProps) => {\n    const { destIds, ...others } = props;\n    const { param } = React.useContext(ParamContext);\n\n    const charCounts = destIds.map(stnId => param.stn_list[stnId].name[0].length);\n    const minCharCounts = Math.min(...charCounts);\n    const charSpacing =\n        minCharCounts > 1 && charCounts[0] !== charCounts[1]\n            ? Math.abs(charCounts[0] - charCounts[1]) / (minCharCounts - 1)\n            : 0;\n\n    return (\n        <g {...others}>\n            {destIds.map((id, i) => (\n                <React.Fragment key={id}>\n                    <text\n                        className=\"rmg-name__zh\"\n                        fontSize={25}\n                        x={param.direction === 'l' ? 0 : -75}\n                        y={-21 + 42 * i}\n                        letterSpacing={charCounts[i] > charCounts[1 - i] ? '0em' : `${charSpacing}em`}\n                    >\n                        {param.stn_list[id].name[0]}\n                    </text>\n                    <text\n                        className=\"rmg-name__en\"\n                        fontSize={11.5}\n                        x={param.direction === 'l' ? 0 : -75}\n                        y={-1 + 42 * i}\n                    >\n                        {'Towards ' + param.stn_list[id].name[1].replace('\\\\', ' ')}\n                    </text>\n                </React.Fragment>\n            ))}\n            <text\n                className=\"rmg-name__zh\"\n                fontSize={28}\n                x={param.direction === 'l' ? 25 * (Math.max(...charCounts) + 1) : 0}\n                y={5}\n            >\n                \n            </text>\n        </g>\n    );\n};\n\nconst TerminusFlag = React.memo(() => (\n    <g id=\"terminus_gz\" textAnchor=\"middle\">\n        <text className=\"rmg-name__zh\" fontSize={90}>\n              \n        </text>\n        <text dy={70} className=\"rmg-name__en\" fontSize={36}>\n            Terminal\n        </text>\n        <g strokeWidth={8} stroke=\"#000\">\n            <path d=\"M -160,68 h -160\" />\n            <path d=\"M 160,68 h 160\" />\n        </g>\n    </g>\n));\n\nconst NoteBox = React.memo(\n    (props: { note: Note }) => {\n        const noteTextEl = React.useRef<SVGGElement | null>(null);\n        const [bBox, setBBox] = React.useState({ width: 0, height: 0, y: 0 } as DOMRect);\n        React.useEffect(() => setBBox(noteTextEl.current!.getBBox()), [props.note[0], props.note[1]]);\n\n        return (\n            <g\n                className=\"note-box\"\n                style={{ ['--x-percentage' as any]: props.note[2], ['--y-percentage' as any]: props.note[3] }}\n            >\n                {props.note[4] && (\n                    <rect\n                        height={bBox.height + 4}\n                        width={bBox.width + 4}\n                        x={-2}\n                        y={bBox.y - 2}\n                        fill=\"none\"\n                        stroke=\"black\"\n                        strokeWidth={0.5}\n                    />\n                )}\n                <g ref={noteTextEl}>\n                    <g fontSize={16} letterSpacing={1.2}>\n                        {props.note[0].split('\\n').map((txt, i) => (\n                            <text key={i} className=\"rmg-name__zh\" y={i * 18}>\n                                {txt}\n                            </text>\n                        ))}\n                    </g>\n\n                    <g\n                        fontSize={10}\n                        letterSpacing={0.33}\n                        transform={`translate(0,${18 * props.note[0].split('\\n').length})`}\n                    >\n                        {props.note[1].split('\\n').map((txt, i) => (\n                            <text\n                                key={i}\n                                className=\"rmg-name__en\"\n                                y={i * 11}\n                                textLength={i < (props.note[1].match(/\\n/g)?.length || 0) ? bBox.width : 0}\n                                lengthAdjust=\"spacing\"\n                            >\n                                {txt}\n                            </text>\n                        ))}\n                    </g>\n                </g>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => prevProps.note.toString() === nextProps.note.toString()\n);\n"],"sourceRoot":""}