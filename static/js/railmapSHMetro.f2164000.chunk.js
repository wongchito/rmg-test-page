(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[82],{111:function(t,n,e){"use strict";e.r(n);var a=e(0),r=e.n(a),c=e(4),i=e(3),o=e(1),s=e(5),l=e(24),u=e(23),f=e(8),h=function(t){var n=Object(a.useContext)(s.b).param,e=n.stn_list[t.stnId],c=([].concat(Object(f.a)(e.branch.left),Object(f.a)(e.branch.right)).length?8+12*e.name[1].split("\\").length:0)*("l"===n.direction?1:-1);return r.a.createElement(r.a.Fragment,null,r.a.createElement("use",{xlinkHref:"#"+(e.transfer.info.reduce((function(t,n){return t+n.length}),0)?"int2_sh":"stn_sh"),stroke:-1===t.stnState?"#aaa":"var(--rmg-theme-colour)"}),r.a.createElement("g",{transform:"translate(".concat(c,",0)")},r.a.createElement(d,{name:e.name,infos:e.transfer.info,stnState:t.stnState,direction:n.direction})))},d=function(t){var n,e,i=t.name[1].split("\\").length,o=Object(a.useRef)(null),s=r.a.useState({width:0}),l=Object(c.a)(s,2),u=l[0],h=l[1];r.a.useEffect((function(){return h(o.current.getBBox())}),Object(f.a)(t.name));var d=u.width+5;return r.a.createElement("g",{transform:"translate(".concat("l"===t.direction?6:-6,",-6)rotate(").concat("l"===t.direction?-45:45,")")},t.infos.reduce((function(t,n){return t+n.length}),0)&&r.a.createElement("line",{x1:0,x2:"l"===t.direction?d:-d,stroke:-1===t.stnState?"#aaa":"black",strokeWidth:.5}),r.a.createElement(g,{intInfos:t.infos[1]?(n=[]).concat.apply(n,Object(f.a)(t.infos)):t.infos[0],transform:"translate(".concat(d*("l"===t.direction?1:-1),",-10.75)"),direction:t.direction}),r.a.createElement("g",{textAnchor:"l"===t.direction?"start":"end",transform:"translate(0,".concat(-16.15625-12*(i-1),")")},r.a.createElement(m,{ref:o,stnName:t.name,fill:-1===t.stnState?"#aaa":0===t.stnState?"red":"black"}),(null===(e=t.infos[1])||void 0===e?void 0:e.length)&&r.a.createElement("g",{transform:"translate(".concat((d+15*t.infos.reduce((function(t,n){return t+n.length}),0))*("l"===t.direction?1:-1),",-22)")},r.a.createElement(O,{osiInfos:t.infos[1]}))))},m=r.a.forwardRef((function(t,n){var e=t.stnName,a=Object(u.a)(t,["stnName"]);return r.a.createElement("g",Object.assign({ref:n},a),r.a.useMemo((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("text",{className:"rmg-name__zh"},e[0]),r.a.createElement("g",{fontSize:9.6},e[1].split("\\").map((function(t,n){return r.a.createElement("text",{key:n,className:"rmg-name__en",dy:12*(n+1)},t)}))))}),Object(f.a)(e)))})),g=function(t){var n=t.intInfos,e=(t.direction,Object(u.a)(t,["intInfos","direction"])),a=0;return r.a.createElement("g",Object.assign({fontSize:14,textAnchor:"middle"},e),n.map((function(n,e){var c=Boolean(n[4].match(/^\d.*$/));"r"===t.direction&&0===e&&(a-=c?20:14*n[4].length+12+0);var i=r.a.createElement("g",{transform:"translate(".concat(a,",0)"),key:e},c?r.a.createElement(p,{info:n}):r.a.createElement(b,{info:n}));return"l"===t.direction?a+=c?25:14*n[4].length+12+5:a-=c?25:14*n[4].length+12+5,i})))},p=Object(a.memo)((function(t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("use",{xlinkHref:"#intbox_number",fill:t.info[2]}),r.a.createElement("text",{x:10,className:"rmg-name__zh",fill:t.info[3],dominantBaseline:"central"},t.info[4].match(/(\d*)\w+/)[0]))}),(function(t,n){return t.info.toString()===n.info.toString()})),b=Object(a.memo)((function(t){var n=t.info[4].split("\\")[0].length;return r.a.createElement(r.a.Fragment,null,r.a.createElement("rect",{height:22,width:14*n+12,y:-11,fill:t.info[2]}),r.a.createElement("text",{x:7*n+6,className:"rmg-name__zh",fill:t.info[3],dominantBaseline:"central"},t.info[4].split("\\")[0]))}),(function(t,n){return t.info.toString()===n.info.toString()})),O=function(t){var n=t.osiInfos.map((function(t){return t[4]}));return r.a.useMemo((function(){return r.a.createElement("g",{textAnchor:"middle",fontSize:"50%"},r.a.createElement("text",{className:"rmg-name__zh"},"\u6362\u4e58"+n.join("\uff0c")),r.a.createElement("text",{className:"rmg-name__zh",dy:10},"\u4ec5\u9650\u516c\u5171\u4ea4\u901a\u5361"))}),Object(f.a)(n))},v=function(){var t=Object(a.useContext)(s.b),n=t.param,e=t.routes,c=t.branches,u=t.deps,f=Object(l.b)(n.stn_list,(function(){return 0}),(function(){return 0})),h=Object(l.c)("linestart","lineend",f),d=Object(l.c)(h.nodes[1],h.nodes.slice(-2)[0],f),m=r.a.useMemo((function(){return console.log("computing x shares"),Object.keys(n.stn_list).reduce((function(t,n){return Object(o.a)({},t,Object(i.a)({},n,Object(l.f)(n,f,c)))}),{})}),[c.toString(),JSON.stringify(f)]),g=[n.svgWidth.railmap*n.padding/100,n.svgWidth.railmap*(1-n.padding/100)],p=Object.keys(m).reduce((function(t,n){return Object(o.a)({},t,Object(i.a)({},n,g[0]+m[n]/d.len*(g[1]-g[0])))}),{}),b=r.a.useMemo((function(){return console.log("computing y shares"),Object.keys(n.stn_list).reduce((function(t,n){return Object(o.a)({},t,Object(i.a)({},n,c[0].includes(n)?0:3))}),{})}),[u]),O=Object.keys(b).reduce((function(t,e){return Object(o.a)({},t,Object(i.a)({},e,-b[e]*n.branch_spacing))}),{}),v=r.a.useMemo((function(){return Object(l.e)(n.current_stn_idx,e,n.direction)}),[n.current_stn_idx,n.direction,e.toString()]),x=Object(l.d)(c,v),_=Object.keys(x).reduce((function(t,e){return Object(o.a)({},t,Object(i.a)({},e,x[e].map((function(t){return j(t,e,p,O,n.direction)}))))}),{});return r.a.createElement("g",{id:"main",transform:"translate(0,".concat(n.svg_height-63,")")},r.a.createElement(y,{paths:_}),r.a.createElement(E,{xs:p,ys:O,stnStates:v}))},y=function(t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("g",null,t.paths.pass.map((function(t,n){return r.a.createElement("path",{key:n,stroke:"gray",strokeWidth:12,fill:"none",d:t})}))),r.a.createElement("g",null,t.paths.main.map((function(t,n){return r.a.createElement("path",{key:n,fill:"var(--rmg-theme-colour)",d:t})}))))},j=function(t,n,e,a,r){var i=Object(c.a)([],2),o=i[0],s=i[1],l={},u=30;if(t.forEach((function(t){var n=e[t],r=a[t];if(!o&&0!==o)return s=n,o=r,void(l.start=[n,r]);0===r?r!==o&&(l.bifurcate=[s,o]):r!==o&&(l.bifurcate=[n,r]),l.end=[n,r],s=n,o=r})),l.hasOwnProperty("start")){if(l.hasOwnProperty("end")){if(l.hasOwnProperty("bifurcate")){var f=Object(c.a)(l.start,2),h=f[0],d=f[1],m=Object(c.a)(l.end,2),g=m[0],p=m[1];return"main"===n?"l"===r?p>d?"M ".concat(h-u,",").concat(d-6," H ").concat(g+6," V ").concat(p-6," h -12 V ").concat(d+6," H ").concat(h-u-12," Z"):"M ".concat(g,",").concat(p-6," H ").concat(h-6," V ").concat(d-6," h 12 V ").concat(p+6," H ").concat(g," Z"):p>d?"M ".concat(h,",").concat(d-6," H ").concat(g+6," V ").concat(p-6," h -12 V ").concat(d+6," H ").concat(h," Z"):"M ".concat(g+u,",").concat(p-6," H ").concat(h-6," V ").concat(d-6," h 12 V ").concat(p+6," H ").concat(g+u+12," Z"):p>d?"M ".concat(h-u,",").concat(d," H ").concat(g," V ").concat(p):"M ".concat(h,",").concat(d," V ").concat(p," H ").concat(g+u)}var b=Object(c.a)(l.start,2),O=b[0],v=b[1],y=l.end[0];return"main"===n?"l"===r?"M ".concat(O-u,",").concat(v-6," H ").concat(y," l 0,12 L ").concat(O-42,",").concat(v+6," Z"):"M ".concat(O,",").concat(v-6," H ").concat(y+u," l 12,12 L ").concat(O,",").concat(v+6," Z"):"M ".concat(O-u,",").concat(v," H ").concat(y+u)}var j=Object(c.a)(l.start,2),E=j[0],x=j[1];return"main"===n?"l"===r?"M ".concat(E,",").concat(x-6," L ").concat(E-u,",").concat(x-6," l -12,12 L ").concat(E,",").concat(x+6," Z"):"M ".concat(E,",").concat(x-6," L ").concat(E+u,",").concat(x-6," l 12,12 L ").concat(E,",").concat(x+6," Z"):"l"===r?"M ".concat(E,",").concat(x," L ").concat(E+u,",").concat(x):"M ".concat(E-u,",").concat(x," L ").concat(E,",").concat(x)}return""},E=function(t){var n=Object(a.useContext)(s.b).param;return r.a.createElement("g",null,Object.keys(n.stn_list).filter((function(t){return!["linestart","lineend"].includes(t)})).map((function(n){return r.a.createElement("g",{key:n,transform:"translate(".concat(t.xs[n],",").concat(t.ys[n],")")},r.a.createElement(h,{stnId:n,stnState:t.stnStates[n]}))})))},x=a.memo((function(){return a.createElement(a.Fragment,null,a.createElement(_,null),a.createElement(v,null))})),_=(n.default=x,a.memo((function(){return a.createElement("defs",null,a.createElement("circle",{id:"stn_sh",fill:"#fff",strokeWidth:2,r:5}),a.createElement("path",{id:"int2_sh",fill:"#fff",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),a.createElement("rect",{id:"intbox_number",height:22,width:20,y:-11}))})))},23:function(t,n,e){"use strict";function a(t,n){if(null==t)return{};var e,a,r=function(t,n){if(null==t)return{};var e,a,r={},c=Object.keys(t);for(a=0;a<c.length;a++)e=c[a],n.indexOf(e)>=0||(r[e]=t[e]);return r}(t,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(a=0;a<c.length;a++)e=c[a],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e])}return r}e.d(n,"a",(function(){return a}))},24:function(t,n,e){"use strict";e.d(n,"b",(function(){return l})),e.d(n,"c",(function(){return u})),e.d(n,"f",(function(){return f})),e.d(n,"e",(function(){return h})),e.d(n,"a",(function(){return d})),e.d(n,"d",(function(){return m}));var a=e(4),r=e(12),c=e(13),i=e(8),o=e(3),s=e(1),l=(e(9),function(t,n,e){return Object.keys(t).reduce((function(a,r){return Object(s.a)({},a,Object(o.a)({},r,t[r].children.reduce((function(a,c){return Object(s.a)({},a,Object(o.a)({},c,1+n(t,c)+e(t,r)))}),{})))}),{})}),u=function t(n,e,a){if(n===e)return{len:0,nodes:[n]};var r=[],c=[];Object.keys(a[n]).forEach((function(i){var o=t(i,e,a);o.len<0||(r.push(a[n][i]+o.len),o.nodes.unshift(n),c.push(o.nodes))}));var i=Math.max.apply(Math,r);return{len:i,nodes:c[r.indexOf(i)]}},f=function(t,n,e){var a=u("linestart","lineend",n);if(a.nodes.includes(t))return u(a.nodes[1],t,n).len;for(var r=e.filter((function(n){return n.includes(t)}))[0],c=t;!a.nodes.includes(c);)c=r[r.indexOf(c)-1];for(var i=t;!a.nodes.includes(i);)i=r[r.indexOf(i)+1];var o="linestart"===c,s=[];return o||"lineend"===i?o?(s[0]=0,s[1]=u(a.nodes[1],i,n).len,s[2]=u(r[1],t,n).len,s[3]=u(t,i,n).len):(s[0]=u(a.nodes[1],c,n).len,s[1]=u(c,a.nodes.slice(-2)[0],n).len,s[2]=u(c,t,n).len,s[3]=u(t,r.slice(-2)[0],n).len):(s[0]=u(a.nodes[1],c,n).len,s[1]=u(c,i,n).len,s[2]=u(c,t,n).len,s[3]=u(t,i,n).len),s[0]+s[2]*s[1]/(s[2]+s[3])},h=function(t,n,e){var a;return console.log("computing stations' states"),Object(i.a)(new Set((a=[]).concat.apply(a,Object(i.a)(n)))).reduce((function(a,r){return Object(s.a)({},a,Object(o.a)({},r,r===t?0:("r"===e?function(t,n,e){var a=!0,r=!1,c=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var s=i.value,l=s.indexOf(t),u=s.indexOf(n);if(-1!==l&&l<u)return!0}}catch(f){r=!0,c=f}finally{try{a||null==o.return||o.return()}finally{if(r)throw c}}return!1}(t,r,n):function(t,n,e){var a=!0,r=!1,c=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var s=i.value,l=s.indexOf(t),u=s.indexOf(n);if(-1!==u&&u<l)return!0}}catch(f){r=!0,c=f}finally{try{a||null==o.return||o.return()}finally{if(r)throw c}}return!1}(t,r,n))?1:-1))}),{})},d=function(){function t(n){var e=this;Object(r.a)(this,t),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(t){return 0},this.rightWideFactor=function(t){return 0},this.pathWeight=function(t,n){return e.stnList[t].children.includes(n)?1+e.rightWideFactor(t)+e.leftWideFactor(n):-1/0},this.pathTurnParams=function(t){var n=35-17.5*Math.sqrt(3),e=t-2*n;return{tr:35,dx_a:17.5,dy_a:n,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(t){var n=e.pathTurnParams(t),a=n.tr,r=n.dx_a,c=n.dy_a,i=n.dx_l,o=n.dy_l;return"a ".concat(a,",").concat(a," 0 0,1 ").concat(r,",").concat(c," l ").concat(i,",").concat(o," a ").concat(a,",").concat(a," 0 0,0 ").concat(r,",").concat(c)},this.pathTurnNE=function(t){var n=e.pathTurnParams(t),a=n.tr,r=n.dx_a,c=n.dy_a,i=n.dx_l,o=n.dy_l;return"a ".concat(a,",").concat(a," 0 0,0 ").concat(r,",").concat(-c," l ").concat(i,",").concat(-o," a ").concat(a,",").concat(a," 0 0,1 ").concat(r,",").concat(-c)},this.stnList=n.stnList,this.criticalPath=n.criticalPath}return Object(c.a)(t,[{key:"getYShare",value:function(t,n){if(t in this.yShares)return this.yShares[t];if(["linestart","lineend"].includes(t)||this.stnList[t].parents.length>1||this.stnList[t].children.length>1)return this.yShares[t]=0,0;var e=this.stnList[t].parents[0];if(e){if(1===this.stnList[e].children.length){var a=this.getYShare(e);return this.yShares[t]=a,a}var r=0===this.stnList[e].children.indexOf(t)?1:-1;return this.yShares[t]=r,r}return this.yShares[t]=0,0}},{key:"_linePath",value:function(t,n,e,r,c,i,o){var s=this,l=Object(a.a)([],3),u=l[0],f=l[1],h=l[2],d=[],m=this.pathTurnParams(i),g=m.dx_a+m.dx_l/2,p=(n[1]-n[0])/o.len*.8,b=((n[1]-n[0])/o.len-2*g)/2;return b+p<0&&console.warn("SVG width too small! ".concat(b+p)),t.forEach((function(n){var a=r[n],o=c[n];if(!f&&0!==f)return u=n,h=a,f=o,void(1===t.length?d.push("M ".concat(a,",").concat(o)):e[0].includes(n)?e[0].includes(t[1])?d.push("M ".concat(a,",").concat(o)):(r[t[1]]>0&&d.push("M ".concat(a,",").concat(o+9.68)),c[t[1]]<0&&d.push("M ".concat(a,",").concat(o-9.68))):d.push("M ".concat(a,",").concat(o)));o>f?(d.push("h ".concat(0===o?a-h-p*s.leftWideFactor(n)-b-2*g:p*s.rightWideFactor(u)+b)),d.push(s.pathTurnSE(i))):o<f&&(d.push("h ".concat(0===o?a-h-p*s.leftWideFactor(n)-b-2*g:p*s.rightWideFactor(u)+b)),d.push(s.pathTurnNE(i))),d.push("H ".concat(a)),u=n,h=a,f=o})),d.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(t,n){console.log("computing y shares");var e=new this({stnList:t});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in e.yShares||e.getYShare(t,n)})),e.yShares}},{key:"drawLine",value:function(t,n,e,a,r,c,i,o){var s=this,l={main:[],pass:[]};return t.forEach((function(u,f){var h=(u=u.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return n[t]>=0})),d=u.filter((function(t){return n[t]<=0}));1===h.length&&(d=u),0===h.filter((function(t){return-1!==d.indexOf(t)})).length&&h.length&&(d[0]===u[0]?d.push(h[0]):h[0]===u[0]&&h[h.length-1]===u[u.length-1]&&d.length?(d=u,h=[]):d.unshift(h[h.length-1])),l.main.push(new s({stnList:e,criticalPath:o})._linePath(h,a,t,r,c,i,o)),l.pass.push(new s({stnList:e,criticalPath:o})._linePath(d,a,t,r,c,i,o))})),l}}]),t}(),m=function(t,n){var e={main:[],pass:[]};return t.forEach((function(t){var a=(t=t.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return n[t]>=0})),r=t.filter((function(t){return n[t]<=0}));1===a.length&&(r=t),0===a.filter((function(t){return-1!==r.indexOf(t)})).length&&a.length&&(r[0]===t[0]?r.push(a[0]):a[0]===t[0]&&a[a.length-1]===t[t.length-1]&&r.length?(r=t,a=[]):r.unshift(a[a.length-1])),e.main.push(a),e.pass.push(r)})),e}}}]);
//# sourceMappingURL=railmapSHMetro.f2164000.chunk.js.map