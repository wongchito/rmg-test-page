{"version":3,"sources":["panels/save/upload-item.tsx","panels/save/export-diag/utils.ts","panels/save/export-diag/preview-diag.tsx","panels/save/export-diag/index.ts","panels/save/export-diag/dialog.tsx","panels/save/panel.tsx","panels/save/index.ts"],"names":["props","t","useTranslation","React","open","setOpen","importedParam","setImportedParam","ListItem","button","component","htmlFor","ListItemIcon","Icon","ListItemText","primary","type","accept","style","display","id","onChange","event","console","log","target","files","Promise","resolve","reader","FileReader","onloadend","readAsText","then","e","JSON","parse","result","param","ImportDialog","onClose","action","document","getElementById","value","localStorage","rmgParam","stringify","window","location","reload","content","Dialog","DialogTitle","DialogContent","dividers","DialogContentText","whiteSpace","Object","keys","length","stn_list","entries","map","x","includes","name","join","trim","replace","DialogActions","Button","onClick","color","autoFocus","test","svgEl","svgW","viewBox","baseVal","width","svgH","height","setAttribute","toString","canvas","querySelectorAll","Number","ctx","getContext","clearRect","forEach","el","getComputedStyle","fontSize","elStyle","fontFamily","fill","dominantBaseline","textAnchor","removeAttribute","img","Image","onload","setTimeout","drawImage","uri","filename","link","createElement","download","href","body","appendChild","click","removeChild","saveAs","toDataURL","Date","toISOString","addEventListener","src","btoa","unescape","encodeURIComponent","outerHTML","setSvgEl","isLoaded","setIsLoaded","contentEl","key","querySelector","getPropertyValue","match","thisSVGWidth","thisSVGHeight","MAX_WIDTH","Math","min","innerWidth","MAX_HEIGHT","innerHeight","scaleFactor","elem","cloneNode","setProperty","tag","Array","from","filter","l","sheet","cssRules","rule","cssText","txt","s","innerText","prepend","urlParams","get","getBase64FontFace","response","a","all","uris","fonts","ready","handleClose","current","maxWidth","dangerouslySetInnerHTML","__html","ref","disabled","ExportDialog","CanvasContext","canvasAvailable","canvasToShown","previewDialogOpened","setPreviewDialogOpened","setCanvas","List","c","TemplateDialog","allStyles","gzmtr","mtr","shmetro","allLangs","en","SaveLists","state","lang","templateDialogOpened","exportDialogOpened","previewDialogCanvas","styleDialogOpened","langDialogOpened","saveClick","bind","exportDialogClose","previewDialogClose","styleDialogClose","this","setState","set","gtag","event_category","event_label","Card","Divider","secondary","getTransText2","i18n","languages","fallback","LinearProgress","StyleDialog","LangDialog","language","changeLanguage","title","documentElement","Panel","TranslatedSaveLists","withTranslation","Grid","container","spacing","justify","alignItems","item","xs","sm","md","lg"],"mappings":"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","file":"static/js/panelSave.d5d6b968.chunk.js","sourcesContent":["import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport {\n    ListItem,\n    ListItemIcon,\n    Icon,\n    ListItemText,\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    DialogContentText,\n    DialogActions,\n    Button,\n} from '@material-ui/core';\nimport { RMGParam } from '../../types';\n\nexport default props => {\n    const { t } = useTranslation();\n\n    const [open, setOpen] = React.useState(false);\n    const [importedParam, setImportedParam] = React.useState({} as RMGParam);\n\n    const handleUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n        console.log(event.target.files[0]);\n        let filePromise = new Promise((resolve: (event: ProgressEvent<FileReader>) => void) => {\n            let reader = new FileReader();\n            reader.onloadend = resolve;\n            reader.readAsText(event.target.files[0]);\n        });\n        filePromise\n            .then(e => JSON.parse(e.target.result as string))\n            .then(param => {\n                setImportedParam(param);\n                setOpen(true);\n            });\n    };\n\n    const handleClose = (action: string) => () => {\n        if (action === 'close') {\n            (document.getElementById('upload-param') as HTMLInputElement).value = '';\n            setOpen(false);\n            return;\n        }\n        if (action === 'accept') {\n            localStorage.rmgParam = JSON.stringify(importedParam);\n            window.location.reload(true);\n        }\n    };\n\n    return (\n        <div>\n            <ListItem button component=\"label\" htmlFor=\"upload-param\">\n                <ListItemIcon>\n                    <Icon>folder_open</Icon>\n                </ListItemIcon>\n                <ListItemText primary={t('file.open.button')} />\n            </ListItem>\n            <input\n                type=\"file\"\n                accept=\"application/json\"\n                style={{ display: 'none' }}\n                id=\"upload-param\"\n                onChange={handleUpload}\n            />\n            <ImportDialog open={open} onClose={handleClose} content={importedParam} />\n        </div>\n    );\n};\n\ninterface ImportDialogProps {\n    onClose: (action: string) => () => void;\n    open: boolean;\n    content: {} | RMGParam;\n}\n\nfunction ImportDialog(props: ImportDialogProps) {\n    const { t } = useTranslation();\n\n    const describeParams = (param: RMGParam) => {\n        return `Number of stations: ${Object.keys(param.stn_list).length - 2}\n                ${Object.entries(param.stn_list)\n                    .map(x => (['linestart', 'lineend'].includes(x[0]) ? '' : x[1].name.join(' - ')))\n                    .join('\\r\\n')\n                    .trim()\n                    .replace(/\\\\/, ' ')}`;\n    };\n\n    return (\n        <Dialog onClose={props.onClose('close')} open={props.open}>\n            <DialogTitle>Your Configuration</DialogTitle>\n            <DialogContent dividers>\n                <DialogContentText style={{ whiteSpace: 'pre-line' }}>\n                    {Object.keys(props.content).length === 0 ? 'empty' : describeParams(props.content as RMGParam)}\n                </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={props.onClose('close')} color=\"primary\">\n                    {t('dialog.cancel')}\n                </Button>\n                <Button onClick={props.onClose('accept')} color=\"primary\" autoFocus>\n                    Import\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n","export function test(svgEl: SVGSVGElement) {\n    let svgW = svgEl.viewBox.baseVal.width;\n    let svgH = svgEl.viewBox.baseVal.height;\n\n    svgEl.setAttribute('width', svgW.toString());\n    svgEl.setAttribute('height', svgH.toString());\n\n    let canvas = document.querySelectorAll('canvas')[0];\n    canvas.width = Number(svgW) * 2.5;\n    canvas.height = Number(svgH) * 2.5;\n\n    let ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // bypass Chrome min font size (to be improved)\n\n    svgEl.querySelectorAll('.rmg-name__en.rmg-name__mtr--station').forEach(el => el.setAttribute('font-size', '11px'));\n\n    svgEl.querySelectorAll('.rmg-name__zh.IntName').forEach(el => el.setAttribute('font-size', '10px'));\n\n    svgEl.querySelectorAll('.rmg-name__en.rmg-name__mtr--osi').forEach(el => el.setAttribute('font-size', '9px'));\n\n    svgEl\n        .querySelectorAll('.rmg-name__en.rmg-name__gzmtr--next2-dest')\n        .forEach(el => el.setAttribute('font-size', '8.5px'));\n\n    svgEl.querySelectorAll('.rmg-name__en.IntName').forEach(el => el.setAttribute('font-size', '7px'));\n\n    svgEl\n        .querySelectorAll('text:not([font-size]), tspan:not([font-size])')\n        .forEach(el => el.setAttribute('font-size', window.getComputedStyle(el).fontSize));\n\n    svgEl.querySelectorAll('text, tspan').forEach(el => {\n        let elStyle = window.getComputedStyle(el);\n        el.setAttribute('font-family', elStyle.fontFamily);\n        el.setAttribute('fill', elStyle.fill);\n        el.setAttribute('dominant-baseline', elStyle.dominantBaseline);\n        el.setAttribute('text-anchor', elStyle.textAnchor);\n        el.removeAttribute('class');\n    });\n\n    var img = new Image();\n    img.onload = function() {\n        setTimeout(() => {\n            ctx.drawImage(img, 0, 0, Number(svgW) * 2.5, Number(svgH) * 2.5);\n            saveAs(canvas.toDataURL('image/png'), 'rmg.' + new Date().toISOString() + '.png');\n        }, 2000);\n    };\n    // img.onloadend = () => {\n    //     console.log('img loaded')\n    // }\n    img.addEventListener('loadend', () => {\n        console.log('img loaded');\n    });\n    img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgEl.outerHTML)));\n}\n\nfunction saveAs(uri: string, filename: string) {\n    var link = document.createElement('a');\n\n    if (typeof link.download === 'string') {\n        link.href = uri;\n        link.download = filename;\n        //Firefox requires the link to be in the body\n        document.body.appendChild(link);\n        //simulate click\n        link.click();\n        //remove the link when done\n        document.body.removeChild(link);\n    } else {\n        window.open(uri);\n    }\n}\n","import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Button } from '@material-ui/core';\n\nimport { test } from './utils';\n\ninterface Props {\n    onClose: (action: string) => void;\n    open: boolean;\n    canvas: string;\n}\n\nexport default (props: Props) => {\n    const { t } = useTranslation();\n\n    const [svgEl, setSvgEl] = React.useState((document.createElement('svg') as Element) as SVGSVGElement);\n    const [isLoaded, setIsLoaded] = React.useState(false);\n\n    const contentEl = React.useRef<HTMLDivElement>();\n\n    React.useEffect(() => {\n        if (props.canvas === '') {\n            setSvgEl((document.createElement('svg') as Element) as SVGSVGElement);\n            setIsLoaded(false);\n            return;\n        }\n        let [thisSVGWidth, thisSVGHeight] = ['--rmg-svg-width', '--rmg-svg-height']\n            .map(\n                key =>\n                    (document.querySelector(`svg#${props.canvas}`) as SVGSVGElement).style\n                        .getPropertyValue(key)\n                        .match(/\\d+/g)[0]\n            )\n            .map(Number);\n\n        let MAX_WIDTH = Math.min(window.innerWidth, 1412) - 64 - 24 * 2;\n        let MAX_HEIGHT = window.innerHeight - 64 - 64 - 52 - 8 * 2;\n        let scaleFactor = Math.min(MAX_WIDTH / thisSVGWidth, MAX_HEIGHT / thisSVGHeight);\n\n        let elem = document.querySelector(`svg#${props.canvas}`).cloneNode(true) as SVGSVGElement;\n        // elem.setAttribute('width', (thisSVGWidth * scaleFactor).toString());\n        elem.setAttribute('height', (thisSVGHeight * scaleFactor).toString());\n        elem.style.setProperty('all', 'initial');\n\n        let cssTxt = ['share', props.canvas].map(tag => {\n            return Array.from(\n                (Array.from(document.querySelectorAll('link')).filter(l => l.id === 'css_' + tag)[0]\n                    ?.sheet as CSSStyleSheet).cssRules\n            )\n                .map(rule => rule.cssText)\n                .join(' ');\n        });\n\n        cssTxt.forEach(txt => {\n            let s = document.createElement('style');\n            s.innerText = txt;\n            elem.prepend(s);\n        });\n\n        if (window.urlParams.get('style') === 'mtr') {\n            import(/* webpackChunkName: \"panelPreviewMTR\" */ './mtr-helper').then(({ getBase64FontFace }) => {\n                getBase64FontFace(elem).then(async response => {\n                    let uris = await Promise.all(response);\n                    let s = document.createElement('style');\n                    s.innerText = uris.join(' ');\n                    elem.prepend(s);\n\n                    setSvgEl(elem);\n                    document.fonts.ready.then(() => setIsLoaded(true));\n                });\n            });\n        } else {\n            setSvgEl(elem);\n            setIsLoaded(true);\n        }\n    }, [props.canvas]);\n\n    const handleClose = (action: string) => () => {\n        let svgEl = contentEl.current.querySelector('svg');\n        if (action === 'png') {\n            test(svgEl);\n        } else if (action === 'svg') {\n            var link = document.createElement('a');\n            link.href = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgEl.outerHTML)));\n            link.download = 'rmg.' + new Date().toISOString() + '.svg';\n            link.click();\n        }\n        props.onClose('close');\n    };\n\n    return (\n        <Dialog onClose={handleClose('close')} open={props.open} maxWidth={false}>\n            <DialogTitle>{t('file.preview.title')}</DialogTitle>\n            <DialogContent dangerouslySetInnerHTML={{ __html: svgEl.outerHTML }} ref={contentEl} />\n            <DialogActions>\n                <Button onClick={handleClose('close')} color=\"primary\" autoFocus>\n                    {t('dialog.cancel')}\n                </Button>\n                <Button onClick={handleClose('png')} color=\"primary\" disabled={!isLoaded}>\n                    {t('file.preview.png')}\n                </Button>\n                <Button onClick={handleClose('svg')} color=\"primary\" disabled={!isLoaded}>\n                    {t('file.preview.svg')}\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import ExportDialog from './dialog';\n\nexport default ExportDialog;","import * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Dialog, DialogTitle, DialogContent, List, ListItem, ListItemText } from '@material-ui/core';\n\nimport PreviewDialog from './preview-diag';\nimport { CanvasContext } from '../../../context';\n\ninterface Props {\n    onClose: (action: string) => void;\n    open: boolean;\n}\n\nexport default function ExportDialog(props: Props) {\n    const { t } = useTranslation();\n\n    const { canvasAvailable, canvasToShown } = React.useContext(CanvasContext);\n\n    const [previewDialogOpened, setPreviewDialogOpened] = React.useState(false);\n    const [canvas, setCanvas] = React.useState('');\n\n    const handleClose = (action: string) => () => {\n        if (action !== 'close') {\n            setPreviewDialogOpened(true);\n            setCanvas(action);\n        }\n        props.onClose('close');\n    };\n\n    const previewDialogClose = (action: string) => {\n        if (action === 'close') {\n            setPreviewDialogOpened(false);\n            setCanvas('');\n        }\n    };\n\n    return (\n        <>\n            <Dialog onClose={handleClose('close')} open={props.open}>\n                <DialogTitle>{t('file.export.title')}</DialogTitle>\n                <DialogContent dividers>\n                    <List>\n                        {(canvasToShown === 'all' ? canvasAvailable : [canvasToShown]).map(c => (\n                            <ListItem button key={c} onClick={handleClose(c)}>\n                                <ListItemText primary={t('file.export.' + c)} />\n                            </ListItem>\n                        ))}\n                    </List>\n                </DialogContent>\n            </Dialog>\n\n            <PreviewDialog open={previewDialogOpened} onClose={previewDialogClose} canvas={canvas} />\n        </>\n    );\n}\n","import * as React from 'react';\nimport { useTranslation, withTranslation } from 'react-i18next';\n\nimport {\n    Grid,\n    Card,\n    List,\n    ListItem,\n    ListItemIcon,\n    Icon,\n    ListItemText,\n    Divider,\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    LinearProgress,\n} from '@material-ui/core';\n\nimport { getTransText2 } from '../../utils';\n\n// import TemplateDialog from './template-diag';\nimport UploadListItem from './upload-item';\nimport ExportDialog from './export-diag';\n\nconst TemplateDialog = React.lazy(() => import(/* webpackChunkName: \"panelSaveTemplateDialog\" */ './template-diag'));\n\nexport default props => {\n    let TranslatedSaveLists = withTranslation()(SaveLists);\n\n    return (\n        <Grid container spacing={3} justify=\"center\" alignItems=\"center\">\n            <Grid item xs={12} sm={8} md={6} lg={4}>\n                <TranslatedSaveLists />\n            </Grid>\n        </Grid>\n    );\n};\n\nconst allStyles = {\n    gzmtr: 'Guangzhou Metro',\n    mtr: 'MTR',\n    shmetro: 'Shanghai Metro (Alpha)',\n};\n\nconst allLangs = {\n    en: 'English',\n    'zh-Hans': '中文（简体）',\n    'zh-HK': '中文（香港）',\n};\n\ninterface SaveListsProps {\n    t: any;\n    i18n: any;\n}\n\ninterface SaveListsState {\n    style: string;\n    lang: string;\n    templateDialogOpened: boolean;\n    exportDialogOpened: boolean;\n    previewDialogOpened: boolean;\n    previewDialogCanvas: string;\n    styleDialogOpened: boolean;\n    langDialogOpened: boolean;\n}\n\nclass SaveLists extends React.Component<SaveListsProps, SaveListsState> {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            style: window.urlParams.get('style'),\n            lang: window.urlParams.get('lang'),\n            templateDialogOpened: false,\n            exportDialogOpened: false,\n            previewDialogOpened: false,\n            previewDialogCanvas: '',\n            styleDialogOpened: false,\n            langDialogOpened: false,\n        };\n\n        this.saveClick = this.saveClick.bind(this);\n\n        this.exportDialogClose = this.exportDialogClose.bind(this);\n        this.previewDialogClose = this.previewDialogClose.bind(this);\n\n        this.styleDialogClose = this.styleDialogClose.bind(this);\n    }\n\n    saveClick() {\n        let link = document.createElement('a');\n        link.href = 'data:application/json;base64,' + btoa(unescape(encodeURIComponent(localStorage.rmgParam)));\n        link.download = 'rmg.param.' + new Date().toISOString() + '.json';\n        link.click();\n    }\n\n    exportDialogClose(action: string) {\n        if (action === 'close') {\n            this.setState({ exportDialogOpened: false });\n            return;\n        }\n        this.setState({\n            exportDialogOpened: false,\n            previewDialogOpened: true,\n            previewDialogCanvas: action,\n        });\n    }\n\n    previewDialogClose(action: string) {\n        if (action === 'close') {\n            this.setState({\n                previewDialogOpened: false,\n                previewDialogCanvas: '',\n            });\n        }\n    }\n\n    styleDialogClose(action: string) {\n        if (action === 'close' || action === this.state.style) {\n            this.setState({ styleDialogOpened: false });\n        } else {\n            this.setState({\n                style: action,\n                styleDialogOpened: false,\n            });\n\n            window.urlParams.set('style', action);\n            window.gtag('event', 'set', {\n                event_category: 'style',\n                event_label: action,\n            });\n            window.location.href = '?' + window.urlParams.toString();\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <Card>\n                    <List component=\"nav\">\n                        <ListItem button onClick={() => this.setState({ templateDialogOpened: true })}>\n                            <ListItemIcon>\n                                <Icon>note_add</Icon>\n                            </ListItemIcon>\n                            <ListItemText primary={this.props.t('file.new.button')} />\n                        </ListItem>\n                        <UploadListItem />\n                        <ListItem button onClick={this.saveClick}>\n                            <ListItemIcon>\n                                <Icon>save</Icon>\n                            </ListItemIcon>\n                            <ListItemText primary={this.props.t('file.save')} />\n                        </ListItem>\n                        <ListItem button onClick={() => this.setState({ exportDialogOpened: true })}>\n                            <ListItemIcon>\n                                <Icon>cloud_download</Icon>\n                            </ListItemIcon>\n                            <ListItemText primary={this.props.t('file.export.button')} />\n                        </ListItem>\n                    </List>\n                    <Divider />\n                    <List component=\"nav\">\n                        <ListItem button onClick={() => this.setState({ styleDialogOpened: true })}>\n                            <ListItemIcon>\n                                <Icon>style</Icon>\n                            </ListItemIcon>\n                            <ListItemText\n                                primary={this.props.t('file.style.button')}\n                                secondary={this.props.t('file.style.' + this.state.style)}\n                            />\n                        </ListItem>\n                        <ListItem button onClick={() => this.setState({ langDialogOpened: true })}>\n                            <ListItemIcon>\n                                <Icon>translate</Icon>\n                            </ListItemIcon>\n                            <ListItemText\n                                primary={this.props.t('file.lang.button')}\n                                secondary={getTransText2(allLangs, this.props.i18n.languages)}\n                            />\n                        </ListItem>\n                    </List>\n                </Card>\n\n                <React.Suspense fallback={<LinearProgress />}>\n                    <TemplateDialog\n                        open={this.state.templateDialogOpened}\n                        onClose={() => this.setState({ templateDialogOpened: false })}\n                    />\n                </React.Suspense>\n\n                <ExportDialog open={this.state.exportDialogOpened} onClose={this.exportDialogClose} />\n\n                <StyleDialog open={this.state.styleDialogOpened} onClose={this.styleDialogClose} />\n                <LangDialog\n                    open={this.state.langDialogOpened}\n                    onClose={() => this.setState({ langDialogOpened: false })}\n                />\n            </div>\n        );\n    }\n}\n\ninterface StyleDialogProps {\n    onClose: (style: string) => void;\n    open: boolean;\n}\n\nfunction StyleDialog(props: StyleDialogProps) {\n    const { t, i18n } = useTranslation();\n\n    return (\n        <Dialog onClose={() => props.onClose('close')} open={props.open}>\n            <DialogTitle>{t('file.style.title')}</DialogTitle>\n            <DialogContent dividers>\n                <List>\n                    {Object.keys(allStyles).map(key => (\n                        <ListItem button onClick={() => props.onClose(key)} key={key}>\n                            <ListItemText primary={t('file.style.' + key)} />\n                        </ListItem>\n                    ))}\n                </List>\n            </DialogContent>\n        </Dialog>\n    );\n}\n\ninterface LangDialogProps {\n    onClose: () => void;\n    open: boolean;\n}\n\nfunction LangDialog(props: LangDialogProps) {\n    const { t, i18n } = useTranslation();\n\n    const handleClick = (lang: string) => {\n        if (lang === i18n.language) {\n            props.onClose();\n        } else {\n            i18n.changeLanguage(lang).then(t => (document.title = t('title')));\n            // window.urlParams.set('lang', lang);\n            // history.pushState({url:window.location.href}, null, '?' + window.urlParams.toString());\n            window.gtag('event', 'set', {\n                event_category: 'language',\n                event_label: lang,\n            });\n            document.documentElement.setAttribute('lang', lang);\n            props.onClose();\n            // window.location.href = '?' + window.urlParams.toString();\n        }\n    };\n\n    return (\n        <Dialog onClose={props.onClose} open={props.open}>\n            <DialogTitle>{t('file.lang.title')}</DialogTitle>\n            <DialogContent dividers>\n                <List>\n                    {Object.keys(allLangs).map(key => (\n                        <ListItem button onClick={() => handleClick(key)} key={key}>\n                            <ListItemText primary={allLangs[key]} />\n                        </ListItem>\n                    ))}\n                </List>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","import Panel from './panel';\n\nexport default Panel;"],"sourceRoot":""}