{"version":3,"sources":["panels/stations/edit-diag/branch-tab.tsx"],"names":["StationEditBranchTab","props","t","useTranslation","style","margin","BranchSelectSet","stnId","direction","branchEntry","React","useContext","ParamContext","param","stn_list","branch","useMemo","BranchTypeItem","BranchFirstItem","window","urlParams","get","BranchPosItem","dispatch","handleChange","event","branchType","target","value","type","select","width","variant","label","onChange","key","disabled","length","stnInfo","neighbours","parents","children","branchFirst","branchEndFirst","branchEndId","stnList","indexOf","branches","first","transform","map","formatStnName","toString","branchPos","right","left"],"mappings":"gIAAA,uDAgCeA,UAtBf,SAA8BC,GAAmC,IACrDC,EAAMC,2BAAND,EAER,OACI,kBAAC,OAAD,KACI,kBAAC,WAAD,KACI,kBAAC,eAAD,KACI,wBAAIE,MAAO,CAAEC,OAAQ,IAAMH,EAAE,gCAGrC,kBAACI,EAAD,CAAiBC,MAAON,EAAMM,MAAOC,UAAU,SAC/C,kBAAC,UAAD,MACA,kBAAC,WAAD,KACI,kBAAC,eAAD,KACI,wBAAIJ,MAAO,CAAEC,OAAQ,IAAMH,EAAE,iCAGrC,kBAACI,EAAD,CAAiBC,MAAON,EAAMM,MAAOC,UAAU,YAY3D,IAAMF,EAAkB,SAACL,GAAiC,IAGhDQ,EAFYC,IAAMC,WAAWC,KAA3BC,MACcC,SAASb,EAAMM,OACTQ,OAAOd,EAAMO,WAEzC,OAAOE,IAAMM,SACT,kBACI,oCACI,kBAACC,EAAmBhB,GACnBQ,EAAY,IACT,oCACI,kBAACS,EAAoBjB,GACc,YAAlCkB,OAAOC,UAAUC,IAAI,UAA0B,kBAACC,EAAkBrB,OAMnF,CAACA,EAAMM,MAAON,EAAMO,UAAWC,EAAY,MAS7CQ,EAAiB,SAAChB,GAAsB,IAClCC,EAAMC,2BAAND,EADiC,EAGbQ,IAAMC,WAAWC,KAArCC,EAHiC,EAGjCA,MAAOU,EAH0B,EAG1BA,SAETd,EADUI,EAAMC,SAASb,EAAMM,OACTQ,OAAOd,EAAMO,WAEnCgB,EAAe,SAACC,GAClB,IAAIC,EAAaD,EAAME,OAAOC,MACX,OAAfF,GAGOA,IAAejB,EAAY,IAIlCc,EAAS,CACLM,KAAM,6BACNtB,MAAON,EAAMM,MACbC,UAAWP,EAAMO,UACjBkB,gBAKZ,OAAOhB,IAAMM,SACT,kBACI,kBAAC,WAAD,KACI,kBAAC,eAAD,KACI,kBAAC,OAAD,oBAEJ,kBAAC,YAAD,CACIc,QAAM,EACN1B,MAAO,CAAE2B,MAAO,QAChBC,QAAQ,WACRC,MAAO/B,EAAE,mCACTgC,SAAUV,EACVI,MAAOnB,EAAY,IAAM,MAEzB,kBAAC,WAAD,CAAU0B,IAAI,KAAKP,MAAM,KAAKQ,SAAiC,IAAvB3B,EAAY4B,QAC/CnC,EAAE,iCAEP,kBAAC,WAAD,CAAUiC,IAAI,UAAUP,MAAM,UAAUQ,SAAiC,IAAvB3B,EAAY4B,QACzDnC,EAAE,sCAEP,kBAAC,WAAD,CAAUiC,IAAI,aAAaP,MAAM,aAAaQ,SAAiC,IAAvB3B,EAAY4B,QAC/DnC,EAAE,6CAMnB,CAACD,EAAMM,MAAOE,EAAY,MAI5BS,EAAkB,SAACjB,GAAsB,IACnCC,EAAMC,2BAAND,EADkC,EAGdQ,IAAMC,WAAWC,KAArCC,EAHkC,EAGlCA,MAAOU,EAH2B,EAG3BA,SACTe,EAAUzB,EAAMC,SAASb,EAAMM,OAC/BE,EAAc6B,EAAQvB,OAAOd,EAAMO,WACnC+B,EAAiC,SAApBtC,EAAMO,UAAuB8B,EAAQE,QAAUF,EAAQG,SAEpEjB,EAAe,SAACC,GAClB,IAAIiB,EAAcjB,EAAME,OAAOC,MAC/B,GAAInB,EAAY,KAAOiC,EAAvB,CAII,IACIC,EADAC,EAAcF,EAEdG,EAAUhC,EAAMC,SACpB,GAAwB,UAApBb,EAAMO,UAAuB,CAC7B,KAA+C,IAAxCqC,EAAQD,GAAaJ,QAAQH,QAChCO,EAAcC,EAAQD,GAAaH,SAAS,GAEhDE,EAAiBE,EAAQD,GAAaJ,QAAQD,EAAWO,QAAQJ,QAC9D,CACH,KAAgD,IAAzCG,EAAQD,GAAaH,SAASJ,QACjCO,EAAcC,EAAQD,GAAaJ,QAAQ,GAE/CG,EAAiBE,EAAQD,GAAaH,SAASF,EAAWO,QAAQJ,IAEtEnB,EAAS,CACLM,KAAM,8BACNkB,SAAU,CACN,CACIxC,MAAON,EAAMM,MACbC,UAAWP,EAAMO,UACjBwC,MAAON,GAEX,CACInC,MAAOqC,EACPpC,UAA+B,SAApBP,EAAMO,UAAuB,QAAU,OAClDwC,MAAOL,QAO3B,OAAOjC,IAAMM,SACT,kBACI,kBAAC,WAAD,KACI,kBAAC,eAAD,KACI,kBAAC,OAAD,CAAMZ,MAAO,CAAE6C,UAA+B,SAApBhD,EAAMO,UAAuB,YAAc,aAArE,UAEJ,kBAAC,YAAD,CACIsB,QAAM,EACN1B,MAAO,CAAE2B,MAAO,QAChBC,QAAQ,WACRC,MAAO/B,EAAE,8BACTgC,SAAUV,EACVI,MAAOnB,EAAY,IAAM8B,EAAW,IAEnCA,EAAWW,KAAI,SAAA3C,GAAK,OACjB,kBAAC,WAAD,CAAU4B,IAAK5B,EAAOqB,MAAOrB,GACxB4C,YAActC,EAAMC,SAASP,YAOlD,CAACN,EAAMM,MAAOE,EAAY,GAAI8B,EAAWa,cAI3C9B,EAAgB,SAACrB,GAAqB,IAGhCC,EAAMC,2BAAND,EAHgC,EAKZQ,IAAMC,WAAWC,KAArCC,EALgC,EAKhCA,MAAOU,EALyB,EAKzBA,SACTe,EAAUzB,EAAMC,SAASb,EAAMM,OAC/BE,EAAc6B,EAAQvB,OAAOd,EAAMO,WACnC+B,EAAiC,SAApBtC,EAAMO,UAAuB8B,EAAQE,QAAUF,EAAQG,SAEpEjB,EAAe,SAACC,GAClB,IAAI4B,EAA0C,UAAvB5B,EAAME,OAAOC,MAAoB,EAAI,EAC5D,GAAIW,EAAWO,QAAQrC,EAAY,MAAQ4C,EAA3C,CAII,IAAIT,EAAcnC,EAAY,GAC1BoC,EAAUhC,EAAMC,SACpB,GAAwB,UAApBb,EAAMO,UAAuB,CAC7B,KAA+C,IAAxCqC,EAAQD,GAAaJ,QAAQH,QAChCO,EAAcC,EAAQD,GAAaH,SAAS,GAEhDlB,EAAS,CACLM,KAAM,4BACNyB,MAAOrD,EAAMM,MACbgD,KAAMX,QAEP,CACH,KAAgD,IAAzCC,EAAQD,GAAaH,SAASJ,QACjCO,EAAcC,EAAQD,GAAaJ,QAAQ,GAE/CjB,EAAS,CACLM,KAAM,4BACN0B,KAAMtD,EAAMM,MACZ+C,MAAOV,OAMvB,OAAOlC,IAAMM,SACT,kBACI,kBAAC,WAAD,KACI,kBAAC,eAAD,KACI,kBAAC,OAAD,mBAEJ,kBAAC,YAAD,CACIc,QAAM,EACN1B,MAAO,CAAE2B,MAAO,QAChBC,QAAQ,WACRC,MAAO/B,EAAE,kCACTgC,SAAUV,EACVI,MAA8C,IAAvCW,EAAWO,QAAQrC,EAAY,IAAY,QAAU,SAE5D,kBAAC,WAAD,CAAU0B,IAAI,QAAQP,MAAM,SACvB1B,EAAE,mCAEP,kBAAC,WAAD,CAAUiC,IAAI,QAAQP,MAAM,SACvB1B,EAAE,uCAMnB,CAACD,EAAMM,MAAOE,EAAY,GAAI8B,EAAWa","file":"static/js/panelStationsBranch.45878c6e.chunk.js","sourcesContent":["import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { List, ListItem, ListItemText, Divider, Icon, TextField, MenuItem, ListItemIcon } from '@material-ui/core';\nimport { formatStnName } from '../../../utils';\nimport { ParamContext } from '../../../context';\n\ninterface StationEditBranchTabProps {\n    stnId: string;\n}\n\nfunction StationEditBranchTab(props: StationEditBranchTabProps) {\n    const { t } = useTranslation();\n\n    return (\n        <List>\n            <ListItem>\n                <ListItemText>\n                    <h3 style={{ margin: 0 }}>{t('stations.edit.branch.left')}</h3>\n                </ListItemText>\n            </ListItem>\n            <BranchSelectSet stnId={props.stnId} direction=\"left\" />\n            <Divider />\n            <ListItem>\n                <ListItemText>\n                    <h3 style={{ margin: 0 }}>{t('stations.edit.branch.right')}</h3>\n                </ListItemText>\n            </ListItem>\n            <BranchSelectSet stnId={props.stnId} direction=\"right\" />\n        </List>\n    );\n}\n\nexport default StationEditBranchTab;\n\ninterface BranchSelectSetProps {\n    stnId: string;\n    direction: 'left' | 'right';\n}\n\nconst BranchSelectSet = (props: BranchSelectSetProps) => {\n    const { param } = React.useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n    const branchEntry = stnInfo.branch[props.direction];\n\n    return React.useMemo(\n        () => (\n            <>\n                <BranchTypeItem {...props} />\n                {branchEntry[0] && (\n                    <>\n                        <BranchFirstItem {...props} />\n                        {window.urlParams.get('style') !== 'shmetro' && <BranchPosItem {...props} />}\n                    </>\n                )}\n            </>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.stnId, props.direction, branchEntry[0]]\n    );\n};\n\ninterface ItemProps {\n    stnId: string;\n    direction: 'left' | 'right';\n}\n\nconst BranchTypeItem = (props: ItemProps) => {\n    const { t } = useTranslation();\n\n    const { param, dispatch } = React.useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n    const branchEntry = stnInfo.branch[props.direction];\n\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        let branchType = event.target.value as 'na' | 'through' | 'nonthrough';\n        if (branchType === 'na') {\n            // no changes\n            return;\n        } else if (branchType === branchEntry[0]) {\n            // no changes\n            return;\n        } else {\n            dispatch({\n                type: 'UPDATE_STATION_BRANCH_TYPE',\n                stnId: props.stnId,\n                direction: props.direction,\n                branchType,\n            });\n        }\n    };\n\n    return React.useMemo(\n        () => (\n            <ListItem>\n                <ListItemIcon>\n                    <Icon>merge_type</Icon>\n                </ListItemIcon>\n                <TextField\n                    select\n                    style={{ width: '100%' }}\n                    variant=\"outlined\"\n                    label={t('stations.edit.branch.type.title')}\n                    onChange={handleChange}\n                    value={branchEntry[0] || 'na'}\n                >\n                    <MenuItem key=\"na\" value=\"na\" disabled={branchEntry.length !== 0}>\n                        {t('stations.edit.branch.type.na')}\n                    </MenuItem>\n                    <MenuItem key=\"through\" value=\"through\" disabled={branchEntry.length === 0}>\n                        {t('stations.edit.branch.type.through')}\n                    </MenuItem>\n                    <MenuItem key=\"nonthrough\" value=\"nonthrough\" disabled={branchEntry.length === 0}>\n                        {t('stations.edit.branch.type.nonThrough')}\n                    </MenuItem>\n                </TextField>\n            </ListItem>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.stnId, branchEntry[0]]\n    );\n};\n\nconst BranchFirstItem = (props: ItemProps) => {\n    const { t } = useTranslation();\n\n    const { param, dispatch } = React.useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n    const branchEntry = stnInfo.branch[props.direction];\n    const neighbours = props.direction === 'left' ? stnInfo.parents : stnInfo.children;\n\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        let branchFirst = event.target.value;\n        if (branchEntry[1] === branchFirst) {\n            // no changes\n            return;\n        } else {\n            let branchEndId = branchFirst;\n            let branchEndFirst: string;\n            let stnList = param.stn_list;\n            if (props.direction === 'right') {\n                while (stnList[branchEndId].parents.length === 1) {\n                    branchEndId = stnList[branchEndId].children[0];\n                }\n                branchEndFirst = stnList[branchEndId].parents[neighbours.indexOf(branchFirst)];\n            } else {\n                while (stnList[branchEndId].children.length === 1) {\n                    branchEndId = stnList[branchEndId].parents[0];\n                }\n                branchEndFirst = stnList[branchEndId].children[neighbours.indexOf(branchFirst)];\n            }\n            dispatch({\n                type: 'UPDATE_STATION_BRANCH_FIRST',\n                branches: [\n                    {\n                        stnId: props.stnId,\n                        direction: props.direction,\n                        first: branchFirst,\n                    },\n                    {\n                        stnId: branchEndId,\n                        direction: props.direction === 'left' ? 'right' : 'left',\n                        first: branchEndFirst,\n                    },\n                ],\n            });\n        }\n    };\n\n    return React.useMemo(\n        () => (\n            <ListItem>\n                <ListItemIcon>\n                    <Icon style={{ transform: props.direction === 'left' ? 'scale(-1)' : 'scale(1)' }}>share</Icon>\n                </ListItemIcon>\n                <TextField\n                    select\n                    style={{ width: '100%' }}\n                    variant=\"outlined\"\n                    label={t('stations.edit.branch.first')}\n                    onChange={handleChange}\n                    value={branchEntry[1] || neighbours[0]}\n                >\n                    {neighbours.map(stnId => (\n                        <MenuItem key={stnId} value={stnId}>\n                            {formatStnName(param.stn_list[stnId])}\n                        </MenuItem>\n                    ))}\n                </TextField>\n            </ListItem>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.stnId, branchEntry[1], neighbours.toString()]\n    );\n};\n\nconst BranchPosItem = (props: ItemProps) => {\n    // mount only if branchEntry[0] is not undefined\n\n    const { t } = useTranslation();\n\n    const { param, dispatch } = React.useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n    const branchEntry = stnInfo.branch[props.direction] as ['through' | 'nonthrough', string];\n    const neighbours = props.direction === 'left' ? stnInfo.parents : stnInfo.children;\n\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        let branchPos: 0 | 1 = event.target.value === 'lower' ? 1 : 0;\n        if (neighbours.indexOf(branchEntry[1]) === branchPos) {\n            // no changes\n            return;\n        } else {\n            let branchEndId = branchEntry[1];\n            let stnList = param.stn_list;\n            if (props.direction === 'right') {\n                while (stnList[branchEndId].parents.length === 1) {\n                    branchEndId = stnList[branchEndId].children[0];\n                }\n                dispatch({\n                    type: 'UPDATE_STATION_BRANCH_POS',\n                    right: props.stnId,\n                    left: branchEndId,\n                });\n            } else {\n                while (stnList[branchEndId].children.length === 1) {\n                    branchEndId = stnList[branchEndId].parents[0];\n                }\n                dispatch({\n                    type: 'UPDATE_STATION_BRANCH_POS',\n                    left: props.stnId,\n                    right: branchEndId,\n                });\n            }\n        }\n    };\n\n    return React.useMemo(\n        () => (\n            <ListItem>\n                <ListItemIcon>\n                    <Icon>swap_vert</Icon>\n                </ListItemIcon>\n                <TextField\n                    select\n                    style={{ width: '100%' }}\n                    variant=\"outlined\"\n                    label={t('stations.edit.branch.pos.title')}\n                    onChange={handleChange}\n                    value={neighbours.indexOf(branchEntry[1]) === 1 ? 'lower' : 'upper'}\n                >\n                    <MenuItem key=\"upper\" value=\"upper\">\n                        {t('stations.edit.branch.pos.upper')}\n                    </MenuItem>\n                    <MenuItem key=\"lower\" value=\"lower\">\n                        {t('stations.edit.branch.pos.lower')}\n                    </MenuItem>\n                </TextField>\n            </ListItem>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.stnId, branchEntry[1], neighbours.toString()]\n    );\n};\n"],"sourceRoot":""}