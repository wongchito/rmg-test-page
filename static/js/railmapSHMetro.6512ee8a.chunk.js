(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[68],{146:function(t,n,e){"use strict";function r(t,n){if(null==t)return{};var e,r,a=function(t,n){if(null==t)return{};var e,r,a={},c=Object.keys(t);for(r=0;r<c.length;r++)e=c[r],n.indexOf(e)>=0||(a[e]=t[e]);return a}(t,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(r=0;r<c.length;r++)e=c[r],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(a[e]=t[e])}return a}e.d(n,"a",(function(){return r}))},147:function(t,n,e){"use strict";function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}e.d(n,"a",(function(){return r}))},149:function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}e.d(n,"a",(function(){return a}))},153:function(t,n,e){"use strict";e.d(n,"b",(function(){return l})),e.d(n,"c",(function(){return u})),e.d(n,"f",(function(){return f})),e.d(n,"e",(function(){return h})),e.d(n,"a",(function(){return m})),e.d(n,"d",(function(){return d}));var r=e(13),a=e(147),c=e(149),i=e(53),o=e(9),s=e(3),l=(e(43),function(t,n,e){return Object.keys(t).reduce((function(r,a){return Object(s.a)({},r,Object(o.a)({},a,t[a].children.reduce((function(r,c){return Object(s.a)({},r,Object(o.a)({},c,1+n(t,c)+e(t,a)))}),{})))}),{})}),u=function t(n,e,r){if(n==e)return{len:0,nodes:[n]};var a=[],c=[];Object.keys(r[n]).forEach((function(i){var o=t(i,e,r);o.len<0||(a.push(r[n][i]+o.len),o.nodes.unshift(n),c.push(o.nodes))}));var i=Math.max.apply(Math,a);return{len:i,nodes:c[a.indexOf(i)]}},f=function(t,n,e){var r=u("linestart","lineend",n);if(r.nodes.includes(t))return u(r.nodes[1],t,n).len;for(var a=e.filter((function(n){return n.includes(t)}))[0],c=t;!r.nodes.includes(c);)c=a[a.indexOf(c)-1];for(var i=t;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var o="linestart"===c,s=[];return o||"lineend"===i?o?(s[0]=0,s[1]=u(r.nodes[1],i,n).len,s[2]=u(a[1],t,n).len,s[3]=u(t,i,n).len):(s[0]=u(r.nodes[1],c,n).len,s[1]=u(c,r.nodes.slice(-2)[0],n).len,s[2]=u(c,t,n).len,s[3]=u(t,a.slice(-2)[0],n).len):(s[0]=u(r.nodes[1],c,n).len,s[1]=u(c,i,n).len,s[2]=u(c,t,n).len,s[3]=u(t,i,n).len),s[0]+s[2]*s[1]/(s[2]+s[3])},h=function(t,n,e){var r;return console.log("computing stations' states"),Object(i.a)(new Set((r=[]).concat.apply(r,Object(i.a)(n)))).reduce((function(r,a){return Object(s.a)({},r,Object(o.a)({},a,a===t?0:("r"===e?function(t,n,e){var r=!0,a=!1,c=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value,l=s.indexOf(t),u=s.indexOf(n);if(-1!==l&&l<u)return!0}}catch(f){a=!0,c=f}finally{try{r||null==o.return||o.return()}finally{if(a)throw c}}return!1}(t,a,n):function(t,n,e){var r=!0,a=!1,c=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value,l=s.indexOf(t),u=s.indexOf(n);if(-1!==u&&u<l)return!0}}catch(f){a=!0,c=f}finally{try{r||null==o.return||o.return()}finally{if(a)throw c}}return!1}(t,a,n))?1:-1))}),{})},m=function(){function t(n){var e=this;Object(a.a)(this,t),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(t){return 0},this.rightWideFactor=function(t){return 0},this.pathWeight=function(t,n){return e.stnList[t].children.includes(n)?1+e.rightWideFactor(t)+e.leftWideFactor(n):-1/0},this.pathTurnParams=function(t){var n=35-17.5*Math.sqrt(3),e=t-2*n;return{tr:35,dx_a:17.5,dy_a:n,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(t){var n=e.pathTurnParams(t),r=n.tr,a=n.dx_a,c=n.dy_a,i=n.dx_l,o=n.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(c," l ").concat(i,",").concat(o," a ").concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(c)},this.pathTurnNE=function(t){var n=e.pathTurnParams(t),r=n.tr,a=n.dx_a,c=n.dy_a,i=n.dx_l,o=n.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(-c," l ").concat(i,",").concat(-o," a ").concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(-c)},this.stnList=n.stnList,this.criticalPath=n.criticalPath}return Object(c.a)(t,[{key:"getYShare",value:function(t,n){if(t in this.yShares)return this.yShares[t];if(["linestart","lineend"].includes(t)||this.stnList[t].parents.length>1||this.stnList[t].children.length>1)return this.yShares[t]=0,0;var e=this.stnList[t].parents[0];if(e){if(1==this.stnList[e].children.length){var r=this.getYShare(e);return this.yShares[t]=r,r}var a=0==this.stnList[e].children.indexOf(t)?1:-1;return this.yShares[t]=a,a}return this.yShares[t]=0,0}},{key:"getNamePos",value:function(t){if("linestart"===t)return this.namePoss.linestart=!0,!0;var n=this.criticalPath.nodes.indexOf(t)%2;if(-1===n){var e=this.stnList[t].parents[0];if(2===this.stnList[e].children.length){var r=this.getNamePos(e);return this.namePoss[t]=r,r}var a=!this.getNamePos(e);return this.namePoss[t]=a,a}return this.namePoss[t]=1===n,1===n}},{key:"_linePath",value:function(t,n,e,a,c,i,o){var s=this,l=Object(r.a)([],3),u=l[0],f=l[1],h=l[2],m=[],d=this.pathTurnParams(i),g=d.dx_a+d.dx_l/2,p=(n[1]-n[0])/o.len*.8,b=((n[1]-n[0])/o.len-2*g)/2;return b+p<0&&console.warn("SVG width too small! ".concat(b+p)),t.forEach((function(n){var r=a[n],o=c[n];if(!f&&0!==f)return u=n,h=r,f=o,void(1===t.length?m.push("M ".concat(r,",").concat(o)):e[0].includes(n)?e[0].includes(t[1])?m.push("M ".concat(r,",").concat(o)):(a[t[1]]>0&&m.push("M ".concat(r,",").concat(o+9.68)),c[t[1]]<0&&m.push("M ".concat(r,",").concat(o-9.68))):m.push("M ".concat(r,",").concat(o)));o>f?(m.push("h ".concat(0===o?r-h-p*s.leftWideFactor(n)-b-2*g:p*s.rightWideFactor(u)+b)),m.push(s.pathTurnSE(i))):o<f&&(m.push("h ".concat(0===o?r-h-p*s.leftWideFactor(n)-b-2*g:p*s.rightWideFactor(u)+b)),m.push(s.pathTurnNE(i))),m.push("H ".concat(r)),u=n,h=r,f=o})),m.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(t,n){console.log("computing y shares");var e=new this({stnList:t});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in e.yShares||e.getYShare(t,n)})),e.yShares}},{key:"getNamePos",value:function(t,n){console.log("computing name position");var e=new this({stnList:t,criticalPath:n});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in e.namePoss||e.getNamePos(t)})),e.namePoss}},{key:"drawLine",value:function(t,n,e,r,a,c,i,o){var s=this,l={main:[],pass:[]};return t.map((function(u,f){var h=(u=u.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return n[t]>=0})),m=u.filter((function(t){return n[t]<=0}));1===h.length&&(m=u),0==h.filter((function(t){return-1!==m.indexOf(t)})).length&&h.length&&(m[0]===u[0]?m.push(h[0]):h[0]===u[0]&&h[h.length-1]===u[u.length-1]&&m.length?(m=u,h=[]):m.unshift(h[h.length-1])),l.main.push(new s({stnList:e,criticalPath:o})._linePath(h,r,t,a,c,i,o)),l.pass.push(new s({stnList:e,criticalPath:o})._linePath(m,r,t,a,c,i,o))})),l}}]),t}(),d=function(t,n){var e={main:[],pass:[]};return t.map((function(t){var r=(t=t.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return n[t]>=0})),a=t.filter((function(t){return n[t]<=0}));1===r.length&&(a=t),0==r.filter((function(t){return-1!==a.indexOf(t)})).length&&r.length&&(a[0]===t[0]?a.push(r[0]):r[0]===t[0]&&r[r.length-1]===t[t.length-1]&&a.length?(a=t,r=[]):a.unshift(r[r.length-1])),e.main.push(r),e.pass.push(a)})),e}},272:function(t,n,e){"use strict";e.r(n);var r=e(0),a=e(13),c=e(9),i=e(3),o=e(23),s=e(153),l=e(146),u=e(53),f=function(t){var n=r.useContext(o.b).param.stn_list[t.stnId];return r.createElement(r.Fragment,null,r.createElement("use",{xlinkHref:"#"+("none"===n.transfer.type?"stn_sh":"int2_sh")+(-1===t.stnState?"_pass":""),className:"rmg-stn"}),r.createElement("g",{transform:"translate(".concat([].concat(Object(u.a)(n.branch.left),Object(u.a)(n.branch.right)).length?30:0,",0)")},r.createElement(h,{name:n.name,infos:n.transfer.info,isOSI:n.transfer.type.includes("osi"),stnState:t.stnState})))},h=function(t){var n=t.name[1].split("\\").length,e=r.useRef(null),c=r.useState({width:0}),i=Object(a.a)(c,2),o=i[0],s=i[1];r.useEffect((function(){return e.current?s(e.current.getBBox()):void 0}),[t.name.toString()]);var l=o.width+5;return r.createElement("g",{className:"Name Future",transform:"translate(".concat(-(24+12*(n-1))*Math.cos(-45),",").concat(-25.921875-12*(n-1)*Math.cos(-45),")rotate(-50)"),textAnchor:"start"},r.createElement(m,{ref:e,name:t.name}),r.createElement(d,{intInfos:t.isOSI?t.infos.flat():t.infos[0],transform:"translate(".concat(l,",0)")}),t.isOSI&&r.createElement("g",{transform:"translate(".concat(l+15*t.infos.flat().length,",-30)")},r.createElement(b,{osiInfos:t.infos[1]})))},m=r.forwardRef((function(t,n){return r.useMemo((function(){return r.createElement("g",{ref:n},r.createElement("text",{className:"rmg-name__zh"},t.name[0]),r.createElement("g",{fontSize:"60%"},t.name[1].split("\\").map((function(t,n){return r.createElement("text",{key:n,className:"rmg-name__en",dy:12*(n+1)},t)}))))}),[t.name.toString()])})),d=function(t){var n=t.intInfos,e=Object(l.a)(t,["intInfos"]),a=0;return r.createElement("g",e,n.map((function(t,n){var e=Boolean(t[4].match(/^\d.*$/)),c=r.createElement("g",{transform:"translate(".concat(a,",0)"),key:n},e?r.createElement(g,{info:t}):r.createElement(p,{info:t}));return a+=e?25:16*t[4].length+12+5,c})))},g=r.memo((function(t){return r.createElement(r.Fragment,null,r.createElement("rect",{height:30,width:20,y:-15,fill:t.info[2]}),r.createElement("text",{x:10,className:"rmg-name__zh",textAnchor:"middle",fill:t.info[3],dominantBaseline:"central"},t.info[4].match(/(\d*)\w+/)[0]))}),(function(t,n){return t.info.toString()===n.info.toString()})),p=r.memo((function(t){var n=t.info[4].split("\\")[0].length;return r.createElement(r.Fragment,null,r.createElement("rect",{height:30,width:16*n+12,y:-15,fill:t.info[2]}),r.createElement("text",{x:8*n+6,className:"rmg-name__zh",textAnchor:"middle",fill:t.info[3],dominantBaseline:"central"},t.info[4].split("\\")[0]))}),(function(t,n){return t.info.toString()===n.info.toString()})),b=function(t){var n=t.osiInfos.map((function(t){return t[4]}));return r.useMemo((function(){return r.createElement("g",{textAnchor:"middle",fontSize:"50%"},r.createElement("text",{className:"rmg-name__zh rmg-name__shmetro--station"},"\u6362\u4e58"+n.join("\uff0c")),r.createElement("text",{className:"rmg-name__zh rmg-name__shmetro--station",dy:10},"\u4ec5\u9650\u516c\u5171\u4ea4\u901a\u5361"))}),[n.toString()])},y=function(){var t=r.useContext(o.b),n=t.param,e=t.routes,a=t.branches,l=t.deps,u=Object(s.b)(n.stn_list,(function(){return 0}),(function(){return 0})),f=Object(s.c)("linestart","lineend",u),h=Object(s.c)(f.nodes[1],f.nodes.slice(-2)[0],u),m=r.useMemo((function(){return console.log("computing x shares"),Object.keys(n.stn_list).reduce((function(t,n){return Object(i.a)({},t,Object(c.a)({},n,Object(s.f)(n,u,a)))}),{})}),[a.toString(),JSON.stringify(u)]),d=[n.svgWidth.railmap*n.padding/100,n.svgWidth.railmap*(1-n.padding/100)],g=Object.keys(m).reduce((function(t,n){return Object(i.a)({},t,Object(c.a)({},n,d[0]+m[n]/h.len*(d[1]-d[0])))}),{}),p=r.useMemo((function(){return console.log("computing y shares"),Object.keys(n.stn_list).reduce((function(t,n){return Object(i.a)({},t,Object(c.a)({},n,a[0].includes(n)?0:3))}),{})}),[l]),b=Object.keys(p).reduce((function(t,e){return Object(i.a)({},t,Object(c.a)({},e,-p[e]*n.branch_spacing))}),{}),y=r.useMemo((function(){return Object(s.e)(n.current_stn_idx,e,n.direction)}),[n.current_stn_idx,n.direction,e.toString()]),E=Object(s.d)(a,y),j=Object.keys(E).reduce((function(t,e){return Object(i.a)({},t,Object(c.a)({},e,E[e].map((function(t){return O(t,e,g,b,n.direction)}))))}),{});return r.createElement("g",{id:"main",transform:"translate(0,".concat(n.svg_height-63,")")},r.createElement(v,{paths:j}),r.createElement(_,{xs:g,ys:b,stnStates:y}))},v=function(t){return r.createElement(r.Fragment,null,r.createElement("g",{className:"rmg-line rmg-line__pass rmg-line__shmetro"},t.paths.pass.map((function(t,n){return r.createElement("path",{key:n,stroke:"gray",strokeWidth:12,fill:"none",d:t})}))),r.createElement("g",{className:"rmg-line rmg-line__shmetro"},t.paths.main.map((function(t,n){return r.createElement("path",{key:n,fill:"var(--rmg-theme-colour)",d:t})}))))},O=function(t,n,e,r,c){var i=[],o=i[1],s=i[2],l={},u=30;if(t.forEach((function(t){var n=e[t],a=r[t];if(!o&&0!==o)return t,s=n,o=a,void(l.start=[n,a]);0===a?a!=o&&(l.bifurcate=[s,o]):a!=o&&(l.bifurcate=[n,a]),l.end=[n,a],t,s=n,o=a})),l.hasOwnProperty("start")){if(l.hasOwnProperty("end")){if(l.hasOwnProperty("bifurcate")){var f=Object(a.a)(l.start,2),h=f[0],m=f[1],d=(l.end[0],Object(a.a)(l.bifurcate,2)),g=(d[0],d[1],Object(a.a)(l.end,2)),p=g[0],b=g[1];return"main"===n?"l"===c?b>m?"M ".concat(h-u,",").concat(m-6," H ").concat(p+6," V ").concat(b-6," h -12 V ").concat(m+6," H ").concat(h-u-12," Z"):"M ".concat(p,",").concat(b-6," H ").concat(h-6," V ").concat(m-6," h 12 V ").concat(b+6," H ").concat(p," Z"):b>m?"M ".concat(h,",").concat(m-6," H ").concat(p+6," V ").concat(b-6," h -12 V ").concat(m+6," H ").concat(h," Z"):"M ".concat(p+u,",").concat(b-6," H ").concat(h-6," V ").concat(m-6," h 12 V ").concat(b+6," H ").concat(p+u+12," Z"):b>m?"M ".concat(h-u,",").concat(m," H ").concat(p," V ").concat(b):"M ".concat(h,",").concat(m," V ").concat(b," H ").concat(p+u)}var y=Object(a.a)(l.start,2),v=y[0],O=y[1],_=l.end[0];return"main"===n?"l"===c?"M ".concat(v-u,",").concat(O-6," H ").concat(_," l 0,12 L ").concat(v-42,",").concat(O+6," Z"):"M ".concat(v,",").concat(O-6," H ").concat(_+u," l 12,12 L ").concat(v,",").concat(O+6," Z"):"M ".concat(v-u,",").concat(O," H ").concat(_+u)}var E=Object(a.a)(l.start,2),j=E[0],x=E[1];return"main"===n?"l"===c?"M ".concat(j,",").concat(x-6," L ").concat(j-u,",").concat(x-6," l -12,12 L ").concat(j,",").concat(x+6," Z"):"M ".concat(j,",").concat(x-6," L ").concat(j+u,",").concat(x-6," l 12,12 L ").concat(j,",").concat(x+6," Z"):"l"===c?"M ".concat(j,",").concat(x," L ").concat(j+u,",").concat(x):"M ".concat(j-u,",").concat(x," L ").concat(j,",").concat(x)}return""},_=function(t){var n=r.useContext(o.b).param;return r.createElement("g",{id:"stn_icons"},Object.keys(n.stn_list).map((function(n){if(!["linestart","lineend"].includes(n))return r.createElement("g",{key:n,style:{transform:"translate(".concat(t.xs[n],"px,").concat(t.ys[n],"px)")}},r.createElement(f,{stnId:n,stnState:t.stnStates[n]}))})))},E=r.memo((function(){return r.createElement(r.Fragment,null,r.createElement(j,null),r.createElement(y,null))})),j=(n.default=E,r.memo((function(){return r.createElement("defs",null,r.createElement("circle",{id:"stn_sh",fill:"#fff",stroke:"var(--rmg-theme-colour)",strokeWidth:2,r:5}),r.createElement("circle",{id:"stn_sh_pass",fill:"#fff",stroke:"#aaa",strokeWidth:2,r:5}),r.createElement("path",{id:"int2_sh",fill:"#fff",stroke:"var(--rmg-theme-colour)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),r.createElement("path",{id:"int2_sh_pass",fill:"#fff",stroke:"#aaa",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}))})))}}]);
//# sourceMappingURL=railmapSHMetro.6512ee8a.chunk.js.map