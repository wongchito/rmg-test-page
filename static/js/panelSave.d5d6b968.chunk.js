(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[59],{263:function(e,t,n){"use strict";n.r(t);var a=n(147),l=n(149),r=n(157),o=n(156),i=n(154),c=n(158),s=n(0),u=n(26),m=n(198),p=n(236),d=n(133),g=n(103),f=n(231),v=n(132),h=n(232),E=n(135),b=n(139),y=n(269),w=n(250),C=n(251),O=n(54),S=n(13),D=n(233),j=n(252),k=n(234),x=function(e){var t=Object(u.c)().t,n=s.useState(!1),a=Object(S.a)(n,2),l=a[0],r=a[1],o=s.useState({}),i=Object(S.a)(o,2),c=i[0],m=i[1];return s.createElement("div",null,s.createElement(g.a,{button:!0,component:"label",htmlFor:"upload-param"},s.createElement(f.a,null,s.createElement(v.a,null,"folder_open")),s.createElement(h.a,{primary:t("file.open.button")})),s.createElement("input",{type:"file",accept:"application/json",style:{display:"none"},id:"upload-param",onChange:function(e){console.log(e.target.files[0]),new Promise((function(t){var n=new FileReader;n.onloadend=t,n.readAsText(e.target.files[0])})).then((function(e){return JSON.parse(e.target.result)})).then((function(e){m(e),r(!0)}))}}),s.createElement(A,{open:l,onClose:function(e){return function(){if("close"===e)return document.getElementById("upload-param").value="",void r(!1);"accept"===e&&(localStorage.rmgParam=JSON.stringify(c),window.location.reload(!0))}},content:c}))};function A(e){var t,n=Object(u.c)().t;return s.createElement(y.a,{onClose:e.onClose("close"),open:e.open},s.createElement(w.a,null,"Your Configuration"),s.createElement(C.a,{dividers:!0},s.createElement(D.a,{style:{whiteSpace:"pre-line"}},0===Object.keys(e.content).length?"empty":(t=e.content,"Number of stations: ".concat(Object.keys(t.stn_list).length-2,"\n                ").concat(Object.entries(t.stn_list).map((function(e){return["linestart","lineend"].includes(e[0])?"":e[1].name.join(" - ")})).join("\r\n").trim().replace(/\\/," "))))),s.createElement(j.a,null,s.createElement(k.a,{onClick:e.onClose("close"),color:"primary"},n("dialog.cancel")),s.createElement(k.a,{onClick:e.onClose("accept"),color:"primary",autoFocus:!0},"Import")))}var _=n(196),z=n.n(_),I=n(197);function q(e){var t=e.viewBox.baseVal.width,n=e.viewBox.baseVal.height;e.setAttribute("width",t.toString()),e.setAttribute("height",n.toString());var a=document.querySelectorAll("canvas")[0];a.width=2.5*Number(t),a.height=2.5*Number(n);var l=a.getContext("2d");l.clearRect(0,0,a.width,a.height),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach((function(e){return e.setAttribute("font-size","11px")})),e.querySelectorAll(".rmg-name__zh.IntName").forEach((function(e){return e.setAttribute("font-size","10px")})),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--osi").forEach((function(e){return e.setAttribute("font-size","9px")})),e.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach((function(e){return e.setAttribute("font-size","8.5px")})),e.querySelectorAll(".rmg-name__en.IntName").forEach((function(e){return e.setAttribute("font-size","7px")})),e.querySelectorAll("text:not([font-size]), tspan:not([font-size])").forEach((function(e){return e.setAttribute("font-size",window.getComputedStyle(e).fontSize)})),e.querySelectorAll("text, tspan").forEach((function(e){var t=window.getComputedStyle(e);e.setAttribute("font-family",t.fontFamily),e.setAttribute("fill",t.fill),e.setAttribute("dominant-baseline",t.dominantBaseline),e.setAttribute("text-anchor",t.textAnchor),e.removeAttribute("class")}));var r=new Image;r.onload=function(){setTimeout((function(){l.drawImage(r,0,0,2.5*Number(t),2.5*Number(n)),function(e,t){var n=document.createElement("a");"string"===typeof n.download?(n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(e)}(a.toDataURL("image/png"),"rmg."+(new Date).toISOString()+".png")}),2e3)},r.addEventListener("loadend",(function(){console.log("img loaded")})),r.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.outerHTML)))}var N=function(e){var t=Object(u.c)().t,a=s.useState(document.createElement("svg")),l=Object(S.a)(a,2),r=l[0],o=l[1],i=s.useState(!1),c=Object(S.a)(i,2),m=c[0],p=c[1],d=s.useRef();s.useEffect((function(){if(""===e.canvas)return o(document.createElement("svg")),void p(!1);var t=["--rmg-svg-width","--rmg-svg-height"].map((function(t){return document.querySelector("svg#".concat(e.canvas)).style.getPropertyValue(t).match(/\d+/g)[0]})).map(Number),a=Object(S.a)(t,2),l=a[0],r=a[1],i=Math.min(window.innerWidth,1412)-64-48,c=window.innerHeight-64-64-52-16,s=Math.min(i/l,c/r),u=document.querySelector("svg#".concat(e.canvas)).cloneNode(!0);u.setAttribute("height",(r*s).toString()),u.style.setProperty("all","initial"),["share",e.canvas].map((function(e){var t;return Array.from((null===(t=Array.from(document.querySelectorAll("link")).filter((function(t){return t.id==="css_"+e}))[0])||void 0===t?void 0:t.sheet).cssRules).map((function(e){return e.cssText})).join(" ")})).forEach((function(e){var t=document.createElement("style");t.innerText=e,u.prepend(t)})),"mtr"===window.urlParams.get("style")?n.e(58).then(n.bind(null,254)).then((function(e){(0,e.getBase64FontFace)(u).then(function(){var e=Object(I.a)(z.a.mark((function e(t){var n,a;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t);case 2:n=e.sent,(a=document.createElement("style")).innerText=n.join(" "),u.prepend(a),o(u),document.fonts.ready.then((function(){return p(!0)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})):(o(u),p(!0))}),[e.canvas]);var g=function(t){return function(){var n=d.current.querySelector("svg");if("png"===t)q(n);else if("svg"===t){var a=document.createElement("a");a.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n.outerHTML))),a.download="rmg."+(new Date).toISOString()+".svg",a.click()}e.onClose("close")}};return s.createElement(y.a,{onClose:g("close"),open:e.open,maxWidth:!1},s.createElement(w.a,null,t("file.preview.title")),s.createElement(C.a,{dangerouslySetInnerHTML:{__html:r.outerHTML},ref:d}),s.createElement(j.a,null,s.createElement(k.a,{onClick:g("close"),color:"primary",autoFocus:!0},t("dialog.cancel")),s.createElement(k.a,{onClick:g("png"),color:"primary",disabled:!m},t("file.preview.png")),s.createElement(k.a,{onClick:g("svg"),color:"primary",disabled:!m},t("file.preview.svg"))))},P=n(23);var T=function(e){var t=Object(u.c)().t,n=s.useContext(P.a),a=n.canvasAvailable,l=n.canvasToShown,r=s.useState(!1),o=Object(S.a)(r,2),i=o[0],c=o[1],m=s.useState(""),p=Object(S.a)(m,2),f=p[0],v=p[1],E=function(t){return function(){"close"!==t&&(c(!0),v(t)),e.onClose("close")}};return s.createElement(s.Fragment,null,s.createElement(y.a,{onClose:E("close"),open:e.open},s.createElement(w.a,null,t("file.export.title")),s.createElement(C.a,{dividers:!0},s.createElement(d.a,null,("all"===l?a:[l]).map((function(e){return s.createElement(g.a,{button:!0,key:e,onClick:E(e)},s.createElement(h.a,{primary:t("file.export."+e)}))}))))),s.createElement(N,{open:i,onClose:function(e){"close"===e&&(c(!1),v(""))},canvas:f}))},M=s.lazy((function(){return n.e(60).then(n.bind(null,273))})),R={gzmtr:"Guangzhou Metro",mtr:"MTR",shmetro:"Shanghai Metro (Alpha)"},F={en:"English","zh-Hans":"\u4e2d\u6587\uff08\u7b80\u4f53\uff09","zh-HK":"\u4e2d\u6587\uff08\u9999\u6e2f\uff09"},H=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(o.a)(t).call(this,e))).state={style:window.urlParams.get("style"),lang:window.urlParams.get("lang"),templateDialogOpened:!1,exportDialogOpened:!1,previewDialogOpened:!1,previewDialogCanvas:"",styleDialogOpened:!1,langDialogOpened:!1},n.saveClick=n.saveClick.bind(Object(i.a)(n)),n.exportDialogClose=n.exportDialogClose.bind(Object(i.a)(n)),n.previewDialogClose=n.previewDialogClose.bind(Object(i.a)(n)),n.styleDialogClose=n.styleDialogClose.bind(Object(i.a)(n)),n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"saveClick",value:function(){var e=document.createElement("a");e.href="data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),e.download="rmg.param."+(new Date).toISOString()+".json",e.click()}},{key:"exportDialogClose",value:function(e){"close"!==e?this.setState({exportDialogOpened:!1,previewDialogOpened:!0,previewDialogCanvas:e}):this.setState({exportDialogOpened:!1})}},{key:"previewDialogClose",value:function(e){"close"===e&&this.setState({previewDialogOpened:!1,previewDialogCanvas:""})}},{key:"styleDialogClose",value:function(e){"close"===e||e===this.state.style?this.setState({styleDialogOpened:!1}):(this.setState({style:e,styleDialogOpened:!1}),window.urlParams.set("style",e),window.gtag("event","set",{event_category:"style",event_label:e}),window.location.href="?"+window.urlParams.toString())}},{key:"render",value:function(){var e=this;return s.createElement("div",null,s.createElement(p.a,null,s.createElement(d.a,{component:"nav"},s.createElement(g.a,{button:!0,onClick:function(){return e.setState({templateDialogOpened:!0})}},s.createElement(f.a,null,s.createElement(v.a,null,"note_add")),s.createElement(h.a,{primary:this.props.t("file.new.button")})),s.createElement(x,null),s.createElement(g.a,{button:!0,onClick:this.saveClick},s.createElement(f.a,null,s.createElement(v.a,null,"save")),s.createElement(h.a,{primary:this.props.t("file.save")})),s.createElement(g.a,{button:!0,onClick:function(){return e.setState({exportDialogOpened:!0})}},s.createElement(f.a,null,s.createElement(v.a,null,"cloud_download")),s.createElement(h.a,{primary:this.props.t("file.export.button")}))),s.createElement(E.a,null),s.createElement(d.a,{component:"nav"},s.createElement(g.a,{button:!0,onClick:function(){return e.setState({styleDialogOpened:!0})}},s.createElement(f.a,null,s.createElement(v.a,null,"style")),s.createElement(h.a,{primary:this.props.t("file.style.button"),secondary:this.props.t("file.style."+this.state.style)})),s.createElement(g.a,{button:!0,onClick:function(){return e.setState({langDialogOpened:!0})}},s.createElement(f.a,null,s.createElement(v.a,null,"translate")),s.createElement(h.a,{primary:this.props.t("file.lang.button"),secondary:Object(O.b)(F,this.props.i18n.languages)})))),s.createElement(s.Suspense,{fallback:s.createElement(b.a,null)},s.createElement(M,{open:this.state.templateDialogOpened,onClose:function(){return e.setState({templateDialogOpened:!1})}})),s.createElement(T,{open:this.state.exportDialogOpened,onClose:this.exportDialogClose}),s.createElement(L,{open:this.state.styleDialogOpened,onClose:this.styleDialogClose}),s.createElement(B,{open:this.state.langDialogOpened,onClose:function(){return e.setState({langDialogOpened:!1})}}))}}]),t}(s.Component);function L(e){var t=Object(u.c)(),n=t.t;t.i18n;return s.createElement(y.a,{onClose:function(){return e.onClose("close")},open:e.open},s.createElement(w.a,null,n("file.style.title")),s.createElement(C.a,{dividers:!0},s.createElement(d.a,null,Object.keys(R).map((function(t){return s.createElement(g.a,{button:!0,onClick:function(){return e.onClose(t)},key:t},s.createElement(h.a,{primary:n("file.style."+t)}))})))))}function B(e){var t=Object(u.c)(),n=t.t,a=t.i18n;return s.createElement(y.a,{onClose:e.onClose,open:e.open},s.createElement(w.a,null,n("file.lang.title")),s.createElement(C.a,{dividers:!0},s.createElement(d.a,null,Object.keys(F).map((function(t){return s.createElement(g.a,{button:!0,onClick:function(){return(n=t)===a.language||(a.changeLanguage(n).then((function(e){return document.title=e("title")})),window.gtag("event","set",{event_category:"language",event_label:n}),document.documentElement.setAttribute("lang",n)),void e.onClose();var n},key:t},s.createElement(h.a,{primary:F[t]}))})))))}t.default=function(e){var t=Object(u.d)()(H);return s.createElement(m.a,{container:!0,spacing:3,justify:"center",alignItems:"center"},s.createElement(m.a,{item:!0,xs:12,sm:8,md:6,lg:4},s.createElement(t,null)))}}}]);
//# sourceMappingURL=panelSave.d5d6b968.chunk.js.map