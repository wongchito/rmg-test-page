{"version":3,"sources":["svgs/destination/destination-shmetro.tsx"],"names":["memo","DefsSHMetro","InfoSHMetro","id","d","fill","React","useContext","ParamContext","param","routes","destTextEl","createRef","useState","width","flagLength","dh","svg_height","isLeft","direction","arrowX","svgWidth","destination","arrowRotate","validDests","Array","from","Set","filter","route","includes","current_stn_idx","map","res","stnId","reverse","lineNameX","line_name","lineNameZH","lineNameEN","lineNumber","match","transform","xlinkHref","ref","style","textAnchor","className","fontSize","stn_list","name","join","dy","replace","height","dominantBaseline","letterSpacing","dx"],"mappings":"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","file":"static/js/destinationSHMetro.33df128c.chunk.js","sourcesContent":["import React, { memo } from 'react';\nimport { ParamContext } from '../../context';\n\nexport default memo(function DestinationSHMetro() {\n    return (\n        <>\n            <DefsSHMetro />\n            <InfoSHMetro />\n        </>\n    );\n});\n\nconst DefsSHMetro = memo(() => (\n    <defs>\n        <path id=\"arrow_left\" d=\"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z\" fill=\"black\" />\n    </defs>\n));\n\nconst InfoSHMetro = () => {\n    const { param, routes } = React.useContext(ParamContext);\n\n    const destTextEl = React.createRef<SVGGElement>();\n    const [bcr] = React.useState({ width: 0 } as DOMRect);\n    // Chito: bcr.width = 0 or based on dest_text?\n    // React.useEffect(() => setBcr(destTextEl.current.getBoundingClientRect()), []);\n    const flagLength = 160 + 150 + bcr.width + 45 + 50;\n\n    // get the height\n    const dh = param.svg_height - 300;\n\n    // arrow\n    const isLeft = param.direction === 'l' ? 1 : -1;\n    let arrowX = (param.svgWidth.destination - isLeft * flagLength) / 20;\n    arrowX = param.direction === 'l' ? arrowX : param.svgWidth.destination - 20;\n    const arrowRotate = 90 * (1 - isLeft);\n\n    // not in use now\n    // const platformNumX = arrowX + isLeft * (160 + 50 + 75);\n\n    // for each left valid destinations, get the name from id\n    const validDests = Array.from(\n        new Set(\n            routes\n                .filter(route => route.includes(param.current_stn_idx))\n                .map(route => {\n                    let res = route.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n                    return param.direction === 'l' ? res[0] : res.reverse()[0];\n                })\n        )\n    );\n\n    // prepare for the line name\n    let lineNameX = param.direction === 'l' ? param.svgWidth.destination : 360;\n    let [lineNameZH, lineNameEN] = param.line_name;\n\n    // line starts with numbers or letters\n    const lineNumber = lineNameZH.match(/(\\d*)\\w+/);\n    if (lineNumber) {\n        lineNameX -= 180;\n        lineNameZH = '号线';\n    } else {\n        lineNameX -= 280;\n    }\n\n    // the platform screen doors flash light\n    // #20\n    // $('g#station_info_shmetro > rect').attr({ transform: `translate(${this._svgDestWidth / 2},${250 + dh})` })\n\n    return (\n        <g id=\"station_info_shmetro\">\n            <path\n                id=\"line_shmetro_use\"\n                fill=\"var(--rmg-theme-colour)\"\n                d={\n                    param.direction === 'l'\n                        ? `M38,10 H ${param.svgWidth.destination - 20} l 0,12 H 24 Z`\n                        : `M24,10 H ${param.svgWidth.destination - 30} l 12,12 H 24 Z`\n                }\n                transform={`translate(0,${220 + dh})`}\n            />\n            <use\n                id=\"arrow_left_use\"\n                xlinkHref=\"#arrow_left\"\n                transform={`translate(${arrowX},${135 + dh})rotate(${arrowRotate})`}\n            />\n            {/* <!-- Todo: fix this absolute position --> */}\n            {/* Todo: fix svgWidth.destination*0.8, this has only been tested on 1000 width */}\n            <g\n                ref={destTextEl}\n                id=\"dest_text\"\n                style={{\n                    textAnchor: param.direction === 'l' ? 'start' : 'end',\n                    transform: `translate(${param.svgWidth.destination *\n                        (param.direction === 'l' ? 0.2 : 0.8)}px,${135 + dh}px)`,\n                }}\n            >\n                <text className=\"rmg-name__zh rmg-name__shmetro--dest\" fontSize=\"400%\">\n                    {'往' + validDests.map(id => param.stn_list[id].name[0]).join('，')}\n                </text>\n                <text className=\"rmg-name__en rmg-name__shmetro--dest\" fontSize=\"150%\" dy={40}>\n                    {'To ' +\n                        validDests\n                            .map(id => param.stn_list[id].name[1])\n                            .join(', ')\n                            .replace('\\\\', ' ')}\n                </text>\n            </g>\n            <g id=\"line_number\">\n                <rect\n                    fill=\"var(--rmg-theme-colour)\"\n                    transform={\n                        lineNumber\n                            ? `translate(${lineNameX - 150},${70 + dh})`\n                            : `translate(${lineNameX - 10},${60 + dh})`\n                    }\n                    width={lineNumber ? 125 : 260}\n                    height={lineNumber ? 125 : 150}\n                />\n                {lineNumber && (\n                    <text\n                        className=\"rmg-name__zh rmg-name__shmetro--line_number\"\n                        fill=\"var(--rmg-theme-fg)\"\n                        fontSize=\"700%\"\n                        textAnchor=\"middle\"\n                        dominantBaseline=\"central\"\n                        transform={`translate(${lineNameX - 87.5},${132.5 + dh})`}\n                        style={{ letterSpacing: '-5px' }}\n                    >\n                        {lineNumber[0]}\n                    </text>\n                )}\n            </g>\n            <g\n                id=\"line_name_text\"\n                fill={lineNumber ? 'black' : 'var(--rmg-theme-fg)'}\n                transform={`translate(${lineNameX},${135 + dh})`}\n                textAnchor=\"start\"\n            >\n                <text className=\"rmg-name__zh rmg-name__shmetro--line_name\" fontSize=\"500%\">\n                    {lineNameZH}\n                </text>\n                {/* // Todo: set the eng in the middle */}\n                <text\n                    className=\"rmg-name__en rmg-name__shmetro--line_name\"\n                    fontSize=\"200%\"\n                    dy={60}\n                    dx={lineNumber ? 0 : 50}\n                >\n                    {lineNameEN}\n                </text>\n            </g>\n            {/* <!-- # 20 <rect width=\"40\" height=\"30\" fill=\"orange\"/> --> */}\n        </g>\n    );\n};\n"],"sourceRoot":""}