(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[59],{259:function(e,t,n){"use strict";n.r(t);var a=n(13),r=n(0),l=n.n(r),o=n(26),c=n(193),i=n(231),u=n(133),m=n(103),s=n(226),f=n(132),d=n(227),p=n(135),g=n(139),E=n(264),b=n(245),v=n(246),y=n(54),h=n(228),w=n(247),S=n(229);function j(){var e=Object(o.c)().t,t=l.a.useState(!1),n=Object(a.a)(t,2),r=n[0],c=n[1],i=l.a.useState({}),u=Object(a.a)(i,2),p=u[0],g=u[1];return l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a,{button:!0,component:"label",htmlFor:"upload-param"},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"folder_open")),l.a.createElement(d.a,{primary:e("file.open.button")})),l.a.createElement("input",{type:"file",accept:"application/json",style:{display:"none"},id:"upload-param",onChange:function(e){console.log(e.target.files[0]),new Promise((function(t){var n=new FileReader;n.onloadend=t,n.readAsText(e.target.files[0])})).then((function(e){return JSON.parse(e.target.result)})).then((function(e){g(e),c(!0)}))}}),l.a.createElement(C,{open:r,onClose:function(e){return function(){if("close"===e)return document.getElementById("upload-param").value="",void c(!1);"accept"===e&&(localStorage.rmgParam=JSON.stringify(p),window.location.reload(!0))}},content:p}))}function C(e){var t,n=Object(o.c)().t;return l.a.createElement(E.a,{onClose:e.onClose("close"),open:e.open},l.a.createElement(b.a,null,"Your Configuration"),l.a.createElement(v.a,{dividers:!0},l.a.createElement(h.a,{style:{whiteSpace:"pre-line"}},0===Object.keys(e.content).length?"empty":(t=e.content,"Number of stations: ".concat(Object.keys(t.stn_list).length-2,"\n                ").concat(Object.entries(t.stn_list).map((function(e){return["linestart","lineend"].includes(e[0])?"":e[1].name.join(" - ")})).join("\r\n").trim().replace(/\\/," "))))),l.a.createElement(w.a,null,l.a.createElement(S.a,{onClick:e.onClose("close"),color:"primary"},n("dialog.cancel")),l.a.createElement(S.a,{onClick:e.onClose("accept"),color:"primary",autoFocus:!0},"Import")))}var O=n(191),A=n.n(O),k=n(192);function _(e){var t=e.viewBox.baseVal.width,n=e.viewBox.baseVal.height;e.setAttribute("width",t.toString()),e.setAttribute("height",n.toString());var a=document.querySelectorAll("canvas")[0];a.width=2.5*Number(t),a.height=2.5*Number(n);var r=a.getContext("2d");r.clearRect(0,0,a.width,a.height),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach((function(e){return e.setAttribute("font-size","11px")})),e.querySelectorAll(".rmg-name__zh.IntName").forEach((function(e){return e.setAttribute("font-size","10px")})),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--osi").forEach((function(e){return e.setAttribute("font-size","9px")})),e.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach((function(e){return e.setAttribute("font-size","8.5px")})),e.querySelectorAll(".rmg-name__en.IntName").forEach((function(e){return e.setAttribute("font-size","7px")})),e.querySelectorAll("text:not([font-size]), tspan:not([font-size])").forEach((function(e){return e.setAttribute("font-size",window.getComputedStyle(e).fontSize)})),e.querySelectorAll("text, tspan").forEach((function(e){var t=window.getComputedStyle(e);e.setAttribute("font-family",t.fontFamily),e.setAttribute("fill",t.fill),e.setAttribute("dominant-baseline",t.dominantBaseline),e.setAttribute("text-anchor",t.textAnchor||""),e.removeAttribute("class")}));var l=new Image;l.onload=function(){setTimeout((function(){r.drawImage(l,0,0,2.5*Number(t),2.5*Number(n)),function(e,t){var n=document.createElement("a");"string"===typeof n.download?(n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(e)}(a.toDataURL("image/png"),"rmg."+(new Date).toISOString()+".png")}),2e3)},l.addEventListener("loadend",(function(){console.log("img loaded")})),l.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.outerHTML)))}var x=function(e){var t=Object(o.c)().t,l=r.useState(document.createElement("svg")),c=Object(a.a)(l,2),i=c[0],u=c[1],m=r.useState(!1),s=Object(a.a)(m,2),f=s[0],d=s[1],p=r.useRef(null);r.useEffect((function(){if(""===e.canvas)return u(document.createElement("svg")),void d(!1);var t=["--rmg-svg-width","--rmg-svg-height"].map((function(t){return document.querySelector("svg#".concat(e.canvas)).style.getPropertyValue(t).match(/\d+/g)[0]})).map(Number),r=Object(a.a)(t,2),l=r[0],o=r[1],c=Math.min(window.innerWidth,1412)-64-48,i=window.innerHeight-64-64-52-16,m=Math.min(c/l,i/o),s=document.querySelector("svg#".concat(e.canvas)).cloneNode(!0);s.setAttribute("height",(o*m).toString()),s.style.setProperty("all","initial"),["share",e.canvas].map((function(e){var t;return Array.from((null===(t=Array.from(document.querySelectorAll("link")).filter((function(t){return t.id==="css_"+e}))[0])||void 0===t?void 0:t.sheet).cssRules).map((function(e){return e.cssText})).join(" ")})).forEach((function(e){var t=document.createElement("style");t.innerText=e,s.prepend(t)})),"mtr"===window.urlParams.get("style")?n.e(58).then(n.bind(null,249)).then((function(e){(0,e.getBase64FontFace)(s).then(function(){var e=Object(k.a)(A.a.mark((function e(t){var n,a;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t);case 2:n=e.sent,(a=document.createElement("style")).innerText=n.join(" "),s.prepend(a),u(s),document.fonts.ready.then((function(){return d(!0)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})):(u(s),d(!0))}),[e.canvas]);var g=function(t){return function(){var n=p.current.querySelector("svg");if("png"===t)_(n);else if("svg"===t){var a=document.createElement("a");a.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n.outerHTML))),a.download="rmg."+(new Date).toISOString()+".svg",a.click()}e.onClose("close")}};return r.createElement(E.a,{onClose:g("close"),open:e.open,maxWidth:!1},r.createElement(b.a,null,t("file.preview.title")),r.createElement(v.a,{dangerouslySetInnerHTML:{__html:i.outerHTML},ref:p}),r.createElement(w.a,null,r.createElement(S.a,{onClick:g("close"),color:"primary",autoFocus:!0},t("dialog.cancel")),r.createElement(S.a,{onClick:g("png"),color:"primary",disabled:!f},t("file.preview.png")),r.createElement(S.a,{onClick:g("svg"),color:"primary",disabled:!f},t("file.preview.svg"))))},z=n(23);var I=function(e){var t=Object(o.c)().t,n=r.useContext(z.a),l=n.canvasAvailable,c=n.canvasToShown,i=r.useState(!1),s=Object(a.a)(i,2),f=s[0],p=s[1],g=r.useState(""),y=Object(a.a)(g,2),h=y[0],w=y[1],S=function(t){return function(){"close"!==t&&(p(!0),w(t)),e.onClose("close")}};return r.createElement(r.Fragment,null,r.createElement(E.a,{onClose:S("close"),open:e.open},r.createElement(b.a,null,t("file.export.title")),r.createElement(v.a,{dividers:!0},r.createElement(u.a,null,("all"===c?l:[c]).map((function(e){return r.createElement(m.a,{button:!0,key:e,onClick:S(e)},r.createElement(d.a,{primary:t("file.export."+e)}))}))))),r.createElement(x,{open:f,onClose:function(e){"close"===e&&(p(!1),w(""))},canvas:h}))},q=l.a.lazy((function(){return n.e(60).then(n.bind(null,268))}));var N={gzmtr:"Guangzhou Metro",mtr:"MTR",shmetro:"Shanghai Metro (Alpha)"},T={en:"English","zh-Hans":"\u4e2d\u6587\uff08\u7b80\u4f53\uff09","zh-HK":"\u4e2d\u6587\uff08\u9999\u6e2f\uff09"},P=function(){var e=Object(o.c)(),t=e.t,n=e.i18n,c=Object(r.useState)(window.urlParams.get("style")),E=Object(a.a)(c,2),b=E[0],v=E[1],h=Object(r.useState)(!1),w=Object(a.a)(h,2),S=w[0],C=w[1],O=Object(r.useState)(!1),A=Object(a.a)(O,2),k=A[0],_=A[1],x=Object(r.useState)(!1),z=Object(a.a)(x,2),N=(z[0],z[1]),P=Object(r.useState)(""),R=Object(a.a)(P,2),H=(R[0],R[1]),L=Object(r.useState)(!1),B=Object(a.a)(L,2),D=B[0],J=B[1],U=Object(r.useState)(!1),V=Object(a.a)(U,2),W=V[0],G=V[1];return l.a.createElement("div",null,l.a.createElement(i.a,null,l.a.createElement(u.a,{component:"nav"},l.a.createElement(m.a,{button:!0,onClick:function(){return C(!0)}},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"note_add")),l.a.createElement(d.a,{primary:t("file.new.button")})),l.a.createElement(j,null),l.a.createElement(m.a,{button:!0,onClick:function(){var e=document.createElement("a");e.href="data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),e.download="rmg.param."+(new Date).toISOString()+".json",e.click()}},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"save")),l.a.createElement(d.a,{primary:t("file.save")})),l.a.createElement(m.a,{button:!0,onClick:function(){return _(!0)}},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"cloud_download")),l.a.createElement(d.a,{primary:t("file.export.button")}))),l.a.createElement(p.a,null),l.a.createElement(u.a,{component:"nav"},l.a.createElement(m.a,{button:!0,onClick:function(){return J(!0)}},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"style")),l.a.createElement(d.a,{primary:t("file.style.button"),secondary:t("file.style."+b)})),l.a.createElement(m.a,{button:!0,onClick:function(){return G(!0)}},l.a.createElement(s.a,null,l.a.createElement(f.a,null,"translate")),l.a.createElement(d.a,{primary:t("file.lang.button"),secondary:Object(y.b)(T,n.languages)})))),l.a.createElement(l.a.Suspense,{fallback:l.a.createElement(g.a,null)},l.a.createElement(q,{open:S,onClose:function(){return C(!1)}})),l.a.createElement(I,{open:k,onClose:function(e){"close"!==e?(_(!1),H(e),N(!0)):_(!1)}}),l.a.createElement(F,{open:D,onClose:function(e){"close"===e||e===b?J(!1):(v(e),J(!1),window.urlParams.set("style",e),window.gtag("event","set",{event_category:"style",event_label:e}),window.location.href="?"+window.urlParams.toString())}}),l.a.createElement(M,{open:W,onClose:function(){return G(!1)}}))};function F(e){var t=Object(o.c)().t;return l.a.createElement(E.a,{onClose:function(){return e.onClose("close")},open:e.open},l.a.createElement(b.a,null,t("file.style.title")),l.a.createElement(v.a,{dividers:!0},l.a.createElement(u.a,null,Object.keys(N).map((function(n){return l.a.createElement(m.a,{button:!0,onClick:function(){return e.onClose(n)},key:n},l.a.createElement(d.a,{primary:t("file.style."+n)}))})))))}function M(e){var t=Object(o.c)(),n=t.t,a=t.i18n;return l.a.createElement(E.a,{onClose:e.onClose,open:e.open},l.a.createElement(b.a,null,n("file.lang.title")),l.a.createElement(v.a,{dividers:!0},l.a.createElement(u.a,null,Object.keys(T).map((function(t){return l.a.createElement(m.a,{button:!0,onClick:function(){return(n=t)===a.language||(a.changeLanguage(n).then((function(e){return document.title=e("title")})),window.gtag("event","set",{event_category:"language",event_label:n}),document.documentElement.setAttribute("lang",n)),void e.onClose();var n},key:t},l.a.createElement(d.a,{primary:T[t]}))})))))}t.default=function(){var e=Object(o.d)()(P);return l.a.createElement(c.a,{container:!0,spacing:3,justify:"center",alignItems:"center"},l.a.createElement(c.a,{item:!0,xs:12,sm:8,md:6,lg:4},l.a.createElement(e,null)))}}}]);
//# sourceMappingURL=panelSave.000858d5.chunk.js.map